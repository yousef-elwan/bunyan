import{t as e,s as l,c as _,d as L,g as H}from"./helpers-DwlY0Bzp.js";import{i as O,c as N}from"./phoneInput-C4-BQoBS.js";function K(){var q;const s=document.getElementById("loginForm"),c=document.getElementById("registerForm"),w=document.querySelector('form[action*="password/email"]'),d=document.querySelector('form[action*="password/update"]');document.querySelectorAll(".password-input");const n=document.querySelectorAll(".password-toggle-btn"),r=document.getElementById("agreeTerms"),y=document.getElementById("registerSubmitBtn"),g=document.getElementById("mobileRegisterInput"),x=document.getElementById("googleLoginBtnLogin"),p=document.getElementById("googleLoginBtnRegister");if(!((q=window.AppConfig)!=null&&q.csrfToken)&&(s||c||w||d)){console.error("[AuthPages] CSRF token not found. Auth operations will fail.");const o=e("csrf_error");l?l("error",{title:e("error_title"),bodyHtml:o}):alert(o)}function t(o,b){if(!o)return;const m=o.querySelector(".spinner-border");o.disabled=b,m&&m.classList.toggle("d-none",!b),!b&&o===y&&r&&(o.disabled=!r.checked)}function v(){!n||n.length===0||n.forEach(o=>{o.addEventListener("click",function(){const b=this.dataset.toggleid,m=document.querySelector(`.password-input[data-toggleid="${b}"]`),a=document.getElementById(b);m&&a?m.type==="password"?(m.type="text",a.classList.remove("fa-eye"),a.classList.add("fa-eye-slash"),this.setAttribute("aria-label",e("hide_password_label")||"Hide password")):(m.type="password",a.classList.remove("fa-eye-slash"),a.classList.add("fa-eye"),this.setAttribute("aria-label",e("show_password_label")||"Show password")):console.warn("[AuthPages] Password toggle target or icon not found for button:",this,"Expected eyeIconId:",b)})})}v();const k=O(g),F=N(k,g,c.querySelector('.invalid-feedback[data-field="mobile"]'),e);F.setupEventListeners();async function j(o,b){var u,f,S,I,R;if(b.preventDefault(),!((u=window.AppConfig)!=null&&u.csrfToken)){console.error("[AuthPages] Submission attempt without CSRF token."),l?l("error",{bodyHtml:e("csrf_error"),title:e("error_title")}):alert(e("csrf_error"));return}_?_(o):(o.querySelectorAll(".invalid-feedback").forEach(h=>h.textContent=""),o.querySelectorAll(".is-invalid").forEach(h=>h.classList.remove("is-invalid")));const m=o.querySelector('button[type="submit"].submit-btn');t(m,!0);const a=new FormData(o);if(o===c&&g){const h=F?F.getInstance():null,i=g.dataset.hiddenInputName||"mobile";h&&g.value.trim()!==""?h.isValidNumber()?(a.set(i,h.getNumber()),a.set("country_code",h.getSelectedCountryData().dialCode)):console.warn("[AuthPages] Register form: Phone number might be invalid despite pre-check."):g.value.trim()===""&&(a.delete(i),a.delete("country_code"))}try{const h=await fetch(o.action,{method:"POST",headers:{"X-CSRF-TOKEN":window.AppConfig.csrfToken,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:a}),i=await h.json();if(h.ok&&i.success===!0){if(l)l("success",{title:i.title||e("success_title"),bodyHtml:i.message||e("operation_successful"),timerSeconds:i.redirect||(f=i.data)!=null&&f.redirect?2:3,onClose:()=>{var T;const C=i.redirect||((T=i.data)==null?void 0:T.redirect);C?window.location.href=C:o===s||o===c?window.location.href=H("home")||"/":o===w||window.location.reload()}});else{alert(i.message||e("success"));const C=i.redirect||((S=i.data)==null?void 0:S.redirect);C?window.location.href=C:o===s||o===c?window.location.href=H("home")||"/":window.location.reload()}o===w&&o.reset()}else{let C=i.title||e("error_title"),T="";if(h.status===422&&i.errors&&Object.keys(i.errors).length>0){if(L)L(o,i.errors);else for(const P in i.errors){const M=o.querySelector(`[name="${P}"]`),D=o.querySelector(`.invalid-feedback[data-field="${P}"]`);M&&M.classList.add("is-invalid"),D&&(D.textContent=i.errors[P][0])}C=e("validation_error_title");let $=`<ul style="text-align: ${(I=window.AppConfig)!=null&&I.isRTL?"right":"left"}; list-style-position: inside; padding-${(R=window.AppConfig)!=null&&R.isRTL?"right":"left"}: 0; margin:0;">`;for(const P in i.errors)i.errors[P].forEach(M=>$+=`<li style="margin-bottom: 5px;">${M}</li>`);$+="</ul>",T=(i.message&&i.message!==e("validation_error_summary")?i.message:e("validation_error_summary"))+($?"<br>"+$:"")}else i.message?T=i.message:T=e("generic_error_try_again");l?l("error",{title:C,bodyHtml:T,buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}):alert(T.replace(/<br>/g,`
`).replace(/<li>/g,`
- `).replace(/<\/li>|<\/ul>|<ul>/g,""))}}catch(h){console.error("[AuthPages] Form submission fetch/network error:",h);const i=e("network_error");l?l("error",{title:e("error_title"),bodyHtml:i}):alert(i)}finally{t(m,!1)}}function A(){[s,c,w,d].forEach(o=>{o&&o.addEventListener("submit",b=>{if(o===c){let m=!0;const a={},u=[];if(_?_(c):(c.querySelectorAll(".invalid-feedback").forEach(f=>f.textContent=""),c.querySelectorAll(".is-invalid").forEach(f=>f.classList.remove("is-invalid"))),r&&!r.checked){const f=e("agree_to_terms_required");a.agreeTerms=[f],u.push(f),m=!1}if(g&&g.value.trim()!==""&&!F.validate()){const f=e("phone_invalid"),S=g.dataset.hiddenInputName||"mobile";a[S]=[f],u.push(f),m=!1}if(!m){if(b.preventDefault(),L&&Object.keys(a).length>0)L(c,a);else if(Object.keys(a).length>0)for(const f in a){const S=c.querySelector(`[name="${f}"]`),I=c.querySelector(`.invalid-feedback[data-field="${f}"]`);S&&S.classList.add("is-invalid"),I&&(I.textContent=a[f][0])}l&&u.length>0?l("error",{title:e("validation_error_title"),bodyHtml:u.join("<br>")}):u.length>0&&alert(u.join(`
`)),a.agreeTerms?r==null||r.focus():Object.keys(a).some(f=>f.includes("mobile"))&&(g==null||g.focus());return}}j(o,b)})})}A(),(()=>{function o(){if(r&&y&&c){const a=()=>{if(y.disabled=!r.checked,r.checked)if(_)_(c,["agreeTerms"]);else{const u=c.querySelector('.invalid-feedback[data-field="agreeTerms"]');u&&(u.textContent=""),r.classList.remove("is-invalid")}};r.addEventListener("change",a),a()}}function b(){[{el:x,type:"login",tKeyBase:"login_with_google"},{el:p,type:"register",tKeyBase:"login_with_google"}].forEach(u=>{if(u.el){const f=u.el.querySelector(".btn-text-content");if(f){const S=`${u.tKeyBase}_${u.type}_page`,I=u.type==="login"?"Sign in with Google":"Sign up with Google";f.textContent=e(S)||I}u.el.addEventListener("click",S=>{S.preventDefault();const I=`google_${u.type}_title_${u.type}_page`,R=u.type==="login"?"Sign in with Google":"Sign up with Google",h=e(I)||R,i=e("google_oauth_placeholder");l?l("info",{title:h,bodyHtml:i}):alert(i)})}})}function m(){c&&o(),b()}return{initialize:m}})().initialize(),console.log("[AuthPages] Initialization COMPLETE.")}K();async function G(s,c){var n,r,y,g,x;if(c.preventDefault(),!((n=window.AppConfig)!=null&&n.csrfToken)){console.error("[AuthPages] Submission attempt without CSRF token."),l?l("error",{bodyHtml:e("csrf_error"),title:e("error_title")}):alert(e("csrf_error"));return}_?_(s):(s.querySelectorAll(".invalid-feedback").forEach(p=>p.textContent=""),s.querySelectorAll(".is-invalid").forEach(p=>p.classList.remove("is-invalid")));const w=s.querySelector('button[type="submit"].submit-btn');toggleButtonSpinner(w,!0);const d=new FormData(s);if(s===registerForm&&mobileRegisterInput){const p=phoneInputModule.getInstance(),t=mobileRegisterInput.dataset.hiddenInputName||"mobile";p&&mobileRegisterInput.value.trim()!==""?p.isValidNumber()?(d.set(t,p.getNumber()),d.set("country_code",p.getSelectedCountryData().dialCode)):console.warn("[AuthPages] Register form: Phone number might be invalid despite pre-check."):mobileRegisterInput.value.trim()===""&&(d.delete(t),d.delete("country_code"))}try{const p=await fetch(s.action,{method:"POST",headers:{"X-CSRF-TOKEN":window.AppConfig.csrfToken,Accept:"application/json","X-Requested-With":"XMLHttpRequest"},body:d}),t=await p.json();if(p.ok&&t.success===!0){if(l)l("success",{title:t.title||e("success_title"),bodyHtml:t.message||e("operation_successful"),timerSeconds:t.redirect||(r=t.data)!=null&&r.redirect?2:3,onClose:()=>{var k;const v=t.redirect||((k=t.data)==null?void 0:k.redirect);v?window.location.href=v:s===loginForm||s===registerForm?window.location.href=H("home")||"/":s===forgotPasswordForm||window.location.reload()}});else{alert(t.message||e("success"));const v=t.redirect||((y=t.data)==null?void 0:y.redirect);v?window.location.href=v:s===loginForm||s===registerForm?window.location.href=H("home")||"/":window.location.reload()}s===forgotPasswordForm&&s.reset()}else{let v=t.title||e("error_title"),k="";if(p.status===422&&t.errors&&Object.keys(t.errors).length>0){if(L)L(s,t.errors);else for(const A in t.errors){const B=s.querySelector(`[name="${A}"]`),q=s.querySelector(`.invalid-feedback[data-field="${A}"]`);B&&B.classList.add("is-invalid"),q&&(q.textContent=t.errors[A][0])}v=e("validation_error_title");let F=`<ul style="text-align: ${(g=window.AppConfig)!=null&&g.isRTL?"right":"left"}; list-style-position: inside; padding-${(x=window.AppConfig)!=null&&x.isRTL?"right":"left"}: 0; margin:0;">`;for(const A in t.errors)t.errors[A].forEach(B=>F+=`<li style="margin-bottom: 5px;">${B}</li>`);F+="</ul>",k=(t.message&&t.message!==e("validation_error_summary")?t.message:e("validation_error_summary"))+(F?"<br>"+F:"")}else t.message?k=t.message:k=e("generic_error_try_again");l?l("error",{title:v,bodyHtml:k,buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}):alert(k.replace(/<br>/g,`
`).replace(/<li>/g,`
- `).replace(/<\/li>|<\/ul>|<ul>/g,""))}}catch(p){console.error("[AuthPages] Form submission fetch/network error:",p);const t=e("network_error");l?l("error",{title:e("error_title"),bodyHtml:t}):alert(t)}finally{toggleButtonSpinner(w,!1)}}function z(){[loginForm,registerForm,forgotPasswordForm,resetPasswordForm].forEach(s=>{s&&s.addEventListener("submit",c=>{if(s===registerForm){let w=!0;const d={},n=[];if(_?_(registerForm):(registerForm.querySelectorAll(".invalid-feedback").forEach(r=>r.textContent=""),registerForm.querySelectorAll(".is-invalid").forEach(r=>r.classList.remove("is-invalid"))),agreeTermsCheckbox&&!agreeTermsCheckbox.checked){const r=e("agree_to_terms_required");d.agreeTerms=[r],n.push(r),w=!1}if(mobileRegisterInput&&mobileRegisterInput.value.trim()!==""&&!phoneInputModule.validate()){const r=e("phone_invalid"),y=mobileRegisterInput.dataset.hiddenInputName||"mobile";d[y]=[r],n.push(r),w=!1}if(!w){if(c.preventDefault(),L&&Object.keys(d).length>0)L(registerForm,d);else if(Object.keys(d).length>0)for(const r in d){const y=registerForm.querySelector(`[name="${r}"]`),g=registerForm.querySelector(`.invalid-feedback[data-field="${r}"]`);y&&y.classList.add("is-invalid"),g&&(g.textContent=d[r][0])}l&&n.length>0?l("error",{title:e("validation_error_title"),bodyHtml:n.join("<br>")}):n.length>0&&alert(n.join(`
`)),d.agreeTerms?agreeTermsCheckbox==null||agreeTermsCheckbox.focus():Object.keys(d).some(r=>r.includes("mobile"))&&(mobileRegisterInput==null||mobileRegisterInput.focus());return}}G(s,c)})})}z();const U=(()=>{function s(){if(agreeTermsCheckbox&&registerSubmitBtn&&registerForm){const d=()=>{if(registerSubmitBtn.disabled=!agreeTermsCheckbox.checked,agreeTermsCheckbox.checked)if(_)_(registerForm,["agreeTerms"]);else{const n=registerForm.querySelector('.invalid-feedback[data-field="agreeTerms"]');n&&(n.textContent=""),agreeTermsCheckbox.classList.remove("is-invalid")}};agreeTermsCheckbox.addEventListener("change",d),d()}}function c(){[{el:googleLoginBtnLogin,type:"login",tKeyBase:"login_with_google"},{el:googleLoginBtnRegister,type:"register",tKeyBase:"login_with_google"}].forEach(n=>{if(n.el){const r=n.el.querySelector(".btn-text-content");if(r){const y=`${n.tKeyBase}_${n.type}_page`,g=n.type==="login"?"Sign in with Google":"Sign up with Google";r.textContent=e(y)||g}n.el.addEventListener("click",y=>{y.preventDefault();const g=`google_${n.type}_title_${n.type}_page`,x=n.type==="login"?"Sign in with Google":"Sign up with Google",p=e(g)||x,t=e("google_oauth_placeholder");l?l("info",{title:p,bodyHtml:t}):alert(t)})}})}function w(){registerForm&&s(),c()}return{initialize:w}})();U.initialize();console.log("[AuthPages] Initialization COMPLETE.");K();
