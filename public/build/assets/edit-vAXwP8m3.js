import{S as f}from"./main-9Qm2jZ7z.js";import{t as a,g as b}from"./helpers-DwlY0Bzp.js";import{h as w}from"./api-2skSE4Ue.js";import"./index-xsH4HHeE.js";const E=w({multipart:!0});function h(){const v=document.getElementById("editCategoryForm");if(!v)return;const m=document.getElementById("updateCategoryBtn"),n=document.getElementById("imageUpload"),p=document.getElementById("newImagePreviewContainer"),i=document.getElementById("existingImageContainer"),l=document.getElementById("image-drop-area");let s=!1;const y=e=>{document.querySelectorAll(".border-danger").forEach(r=>r.classList.remove("border-danger","focus:border-danger","focus:ring-danger")),document.querySelectorAll(".invalid-feedback").forEach(r=>r.textContent="");for(const[r,t]of Object.entries(e)){const c=r.split(".");let d,g;if(c[0]==="locales"&&c.length===3){const _=window.AppConfig.pageData.locales[c[1]];d=document.getElementById(`name_${_}`),g=document.getElementById(`name_${_}_error`)}else d=document.querySelector(`[name="${r}"]`),g=document.getElementById(`${r}_error`);d&&d.classList.add("border-danger","focus:border-danger","focus:ring-danger"),g&&(g.textContent=Array.isArray(t)?t[0]:t)}const o=document.querySelector(".border-danger, .invalid-feedback:not(:empty)");o&&o.scrollIntoView({behavior:"smooth",block:"center"})},u=e=>{if(s){s=!1;const r=i==null?void 0:i.querySelector("img"),t=i==null?void 0:i.querySelector("button");r&&r.classList.remove("marked-for-deletion"),t&&(t.innerHTML="×",t.title=a("delete_image_tooltip"))}if(!e){p.innerHTML=`<p class="self-center w-full text-sm text-center text-text-secondary">${a("no_new_image_preview")}</p>`;return}if(e.size>2*1024*1024){f.fire(a("swal_file_too_large_title"),a("swal_file_too_large_text"),"warning"),n.value="";return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(e.type)){f.fire(a("swal_invalid_type_title"),a("swal_invalid_type_text"),"warning"),n.value="";return}const o=new FileReader;o.onload=r=>{p.innerHTML=`
                <div class="relative w-28 h-28 group">
                    <img src="${r.target.result}" alt="New Preview" class="object-cover w-full h-full rounded-md border border-border-color">
                    <button type="button" class="absolute top-1 right-1 flex items-center justify-center w-5 h-5 bg-danger rounded-full text-white opacity-0 group-hover:opacity-100 transition-opacity" title="${a("button_remove_image")}">×</button>
                </div>`,p.querySelector("button").addEventListener("click",()=>{n.value="",u(null)})},o.readAsDataURL(e)};i&&i.addEventListener("click",e=>{e.target.closest("button")&&(s=!s,i.querySelector("img").classList.toggle("marked-for-deletion",s),e.target.closest("button").innerHTML=s?"↺":"×",e.target.closest("button").title=s?a("undo_delete_tooltip"):a("delete_image_tooltip"),s&&(n.value="",u(null)))}),n&&n.addEventListener("change",e=>u(e.target.files[0])),l&&(["dragenter","dragover","dragleave","drop"].forEach(e=>l.addEventListener(e,o=>{o.preventDefault(),o.stopPropagation()},!1)),["dragenter","dragover"].forEach(e=>l.addEventListener(e,()=>l.classList.add("drag-over"))),["dragleave","drop"].forEach(e=>l.addEventListener(e,()=>l.classList.remove("drag-over"))),l.addEventListener("drop",e=>{n.files=e.dataTransfer.files,u(e.dataTransfer.files[0])})),v.addEventListener("submit",async function(e){var o,r;e.preventDefault(),m.disabled=!0,m.innerHTML=`<i class="fas fa-spinner fa-spin me-2"></i> ${a("saving")}`,y({});try{const t=new FormData,c=[];window.AppConfig.pageData.locales.forEach(d=>{c.push({locale:d,name:document.getElementById(`name_${d}`).value})}),t.append("locales",JSON.stringify(c)),n.files[0]?t.append("image",n.files[0]):s&&t.append("image",""),t.append("_method","PUT"),await E.post(b("dashboard.category.update"),t),f.fire({icon:"success",title:a("update_success_title"),text:a("update_success_text"),timer:2e3,showConfirmButton:!1}).then(()=>window.location.href=b("dashboard.category.index"))}catch(t){t.response&&t.response.status===422&&y(t.response.data.errors),f.fire({icon:"error",title:a("error_title"),text:((r=(o=t.response)==null?void 0:o.data)==null?void 0:r.message)||a("form_error_text")})}finally{m.disabled=!1,m.innerHTML=a("save")}})}document.addEventListener("DOMContentLoaded",h);
