import"./main-DGq6TtTt.js";import{t as e,s as r,g as L,c as B,d as C}from"./helpers-DwlY0Bzp.js";import{i as j,c as N}from"./phoneInput-C4-BQoBS.js";import{h as R}from"./api-C5g70RCE.js";import"./index-xsH4HHeE.js";function V(){const n=window.AppConfig.user,h=document.querySelector("#contact-phone"),o=document.getElementById("contactForm"),l=(n==null?void 0:n.name)||"",f=(n==null?void 0:n.email)||"",b=(n==null?void 0:n.mobile)||"",D=j(h,l),c=N(D,h,o.querySelector('.invalid-feedback[data-field="mobile"]'),e);if(c.setupEventListeners(),!window.AppConfig.isAuthenticated){const m=o.querySelector('input[name="name"]'),t=o.querySelector('input[name="email"]'),i=o.querySelector('input[name="mobile"]');m&&!m.value&&l&&(m.value=l),t&&!t.value&&f&&(t.value=f),i&&!i.value&&b&&(i.value=b)}o.addEventListener("submit",async m=>{var _,v,I;if(m.preventDefault(),!window.AppConfig.csrfToken){r("error",{bodyHtml:e("csrf_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!L("contact-us")){r("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const t=o.querySelector('button[type="submit"]'),i=t?t.textContent:e("contact_send_button_text");t&&(t.disabled=!0,t.textContent=e("loading_text")),B(o);const u=new FormData(o),d=u.get("mobile");let w=d;if(c){if(d&&d.trim()!==""&&!c.validate()){C(o,{mobile:[e("phone_invalid")]},!0),r("error",{bodyHtml:e("phone_invalid"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),t&&(t.disabled=!1,t.textContent=i);return}(_=c.getInstance())!=null&&_.isValidNumber()?w=c.getInstance().getNumber():(!d||d.trim()==="")&&(w="")}const M={name:u.get("name"),email:u.get("email"),subject:u.get("subject"),mobile:w,message:u.get("message")};try{const P=(await R({onStatusCodeError:{422:s=>{var E,S,q,F,H;const p=(S=(E=s==null?void 0:s.response)==null?void 0:E.data)==null?void 0:S.message,a=(F=(q=s==null?void 0:s.response)==null?void 0:q.data)==null?void 0:F.errors;let A=e("error_title"),y="",g="";if(a&&Object.keys(a).length>0){C?C(o,a):console.warn("[ContactAction] displayActionFormErrors helper not available to show inline errors."),A=e("validation_error_title"),g=`<ul style="text-align: ${window.AppConfig.isRTL?"right":"left"}; list-style-position: inside; padding-${window.AppConfig.isRTL?"right":"left"}: 0; margin:0;">`;for(const T in a)a[T].forEach(k=>g+=`<li style="margin-bottom: 5px;">${k}</li>`);g+="</ul>",y=e("validation_error_summary")+"<br>"+g}else p?y=p:y=e("generic_error_try_again");t&&(t.disabled=!1,t.textContent=i),(H=r)==null||H("error",{title:A,bodyHtml:y,buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}}}).post(L("contact-us"),M)).data;if(t&&(t.disabled=!1,t.textContent=i),(v=r)==null||v("success",{bodyHtml:P.message||e("contact_message_sent_success"),timerSeconds:2,showCloseIcon:!0}),o.reset(),!window.AppConfig.isAuthenticated){const s=o.querySelector('input[name="name"]'),p=o.querySelector('input[name="email"]'),a=o.querySelector('input[name="mobile"]');s&&l&&(s.value=l),p&&f&&(p.value=f),a&&b&&(a.value=b)}}catch(x){console.error("[ContactAction] Contact API error:",x),t&&(t.disabled=!1,t.textContent=i),(I=r)==null||I("error",{bodyHtml:e("network_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{t&&(t.disabled=!1,t.textContent=i)}})}document.addEventListener("DOMContentLoaded",function(){V()});
