class h{constructor(e="myGlobalModal"){if(this.modalId=e,this.modalElement=document.getElementById(this.modalId),this.modalElement||(this._createModalHtml(),this.modalElement=document.getElementById(this.modalId)),!this.modalElement){console.error(`MyGlobalModal: Failed to create or find modal element with ID '${this.modalId}'.`);return}this.titleElement=this.modalElement.querySelector(".my-modal-title"),this.bodyElement=this.modalElement.querySelector(".my-modal-body"),this.actionsElement=this.modalElement.querySelector(".my-modal-actions"),this.closeButton=this.modalElement.querySelector(".my-modal-close-btn"),this.contentElement=this.modalElement.querySelector(".my-modal-content"),this.confirmCallback=null,this.cancelCallback=null,this.currentConfig={},this.autoCloseTimerId=null,this._bindEvents()}_createModalHtml(){const e=`
            <div class="my-modal-content">
                <span class="my-modal-close-btn" aria-label="Close Modal">Ã—</span>
                <h3 class="my-modal-title">Default Title</h3>
                <div class="my-modal-body">
                    <p>Default body content.</p>
                </div>
                <div class="my-modal-actions">
                    <!-- Buttons are populated by JavaScript -->
                </div>
            </div>
        `,o=document.createElement("div");if(o.id=this.modalId,o.className="my-global-modal-hidden-on-load",o.innerHTML=e,document.body.appendChild(o),!document.getElementById("myGlobalModalInitialHideStyle")){const l=document.createElement("style");l.id="myGlobalModalInitialHideStyle",l.textContent=`#${this.modalId}.my-global-modal-hidden-on-load { display: none; }`,document.head.appendChild(l)}}_bindEvents(){this.closeButton&&this.closeButton.addEventListener("click",()=>this.close(!0)),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.modalElement&&this.modalElement.style.display==="flex"&&this.close(!0)})}show(e={}){if(!this.modalElement||!this.titleElement||!this.bodyElement||!this.actionsElement||!this.contentElement){console.error("MyGlobalModal: Core elements are missing. Cannot show modal.");return}this.currentConfig=e,this.autoCloseTimerId&&(clearTimeout(this.autoCloseTimerId),this.autoCloseTimerId=null),this.titleElement.textContent=e.title||s("notification"),this.bodyElement.innerHTML=e.bodyHtml||"",this.actionsElement.innerHTML="",this.contentElement.style.maxWidth=e.maxWidth||"500px",this.closeButton&&(this.closeButton.style.display=e.showCloseIcon!==!1?"block":"none"),e.buttons&&e.buttons.length>0?e.buttons.forEach(o=>{const l=document.createElement("button");l.textContent=o.text,l.className=`my-modal-btn ${o.class||"my-modal-btn-outline"}`,o.id&&(l.id=o.id),l.addEventListener("click",()=>{o.onClick&&o.onClick(),o.isCloseButton!==!1&&this.close()}),this.actionsElement.appendChild(l)}):!e.buttons&&e.showCloseIcon===!1&&console.warn("MyGlobalModal: Modal shown with no buttons and no close icon. User might get stuck."),this.modalElement.classList.remove("my-global-modal-hidden-on-load"),this.modalElement.style.display="flex",e.onOpen&&typeof e.onOpen=="function"&&e.onOpen(),e.timerSeconds&&typeof e.timerSeconds=="number"&&e.timerSeconds>0&&(this.autoCloseTimerId=setTimeout(()=>{this.modalElement.style.display==="flex"&&this.currentConfig===e&&this.close(!1)},e.timerSeconds*1e3))}close(e=!1){if(!this.modalElement||this.modalElement.style.display==="none")return;this.autoCloseTimerId&&(clearTimeout(this.autoCloseTimerId),this.autoCloseTimerId=null),this.modalElement.style.display="none";const o=this.currentConfig.onClose,l=this.currentConfig;this.currentConfig={},o&&typeof o=="function"&&o({triggeredByUiCloseAction:e,config:l})}}function u(n,e={}){let o=window.AppConfig.routes[n]||"#";if(o==="#")return console.warn(`Route "${n}" not found in AppConfig.routes.`),o;for(const l in e){const t=new RegExp(`:${l}(Placeholder)?|\\{${l}\\}`,"g");o=o.replace(t,e[l])}return o}function s(n,e={}){let o=n.split("."),l=window.AppConfig.i18n;for(let t=0;t<o.length;t++)if(l&&typeof l=="object"&&l.hasOwnProperty(o[t]))l=l[o[t]];else return n;if(typeof l=="string")for(let t in e)l=l.replace(`:${t}`,e[t]);return l}function b(){const n=new h,e=s("auth_required_title"),o=s("auth_required_message"),l=s("login_button_text"),t=s("cancel_button_text");if(n&&typeof n.show=="function"){const c=[{text:t,class:"my-modal-btn-outline"}];typeof window.openAuthDialog=="function"?c.unshift({text:l,class:"my-modal-btn-primary",onClick:()=>{n.close(),window.openAuthDialog()}}):u("auth.login")&&c.unshift({text:l,class:"my-modal-btn-primary",onClick:()=>{window.location.href=u("auth.login")}}),n.show({title:e,bodyHtml:o,buttons:c})}else confirm(o+" "+s("go_to_login_page")+s("?"))&&(u("auth.login")?window.location.href=u("auth.login"):console.warn("[Helpers] Login URL not configured."))}function g(n,e){const o=new h;let l;switch(n){case"success":l=s("success_title"),e.timer===null&&(e.timer=3e3);break;case"error":l=s("error_title");break;case"info":l=s("info_title");break;case"warning":l=s("warning_title");break;default:l=s("message")}e.title=e.title||l,o&&typeof o.show=="function"?o.show(e):alert(`${e.title}
${e.bodyHtml||""}`)}function y(n,e=[],o={}){if(!n)return;const l=t=>{const c=o[t]||t,i=n.querySelector(`[name="${c}"]`);i&&(i.classList.remove("is-invalid"),i.type==="tel"&&i.classList.contains("phone-input")&&i.classList.remove("iti-invalid"));const a=n.querySelector(`.invalid-feedback[data-field="${t}"]`);a&&(a.textContent="",a.style.display="none");const m=n.querySelector(`.form-error-message[data-field="${t}"]`);if(m&&(m.textContent=""),i){const r=i.closest(".form-group-v3");r&&r.querySelectorAll(".form-error-message-sidebar, .form-error-message-fallback").forEach(d=>d.remove())}};e.length>0?e.forEach(t=>l(t)):(n.querySelectorAll(".is-invalid").forEach(t=>{t.classList.remove("is-invalid"),t.type==="tel"&&t.classList.contains("phone-input")&&t.classList.remove("iti-invalid")}),n.querySelectorAll(".invalid-feedback").forEach(t=>{t.textContent="",t.style.display="none"}),n.querySelectorAll(".form-error-message").forEach(t=>{t.textContent=""}),n.querySelectorAll(".form-error-message-sidebar, .form-error-message-fallback").forEach(t=>{t.remove()}))}function p(n,e,o=!1,l={}){if(!(!n||!e||Object.keys(e).length===0)){y(n,Object.keys(e),l);for(const t in e){const c=l[t]||t,i=n.querySelector(`[name="${c}"]`);let a=!1;i&&(i.classList.add("is-invalid"),i.type==="tel"&&i.classList.contains("phone-input")&&(t==="mobile"||t==="mobile_raw"||t===c)&&i.classList.add("iti-invalid"));const m=n.querySelector(`.invalid-feedback[data-field="${t}"]`);if(m&&(m.textContent=Array.isArray(e[t])?e[t][0]:e[t],m.style.display="block",a=!0),!a&&!o){const r=n.querySelector(`.form-error-message[data-field="${t}"]`);r&&(r.textContent=Array.isArray(e[t])?e[t][0]:e[t],a=!0)}if(!a&&i){const r=i.closest(".form-group-v3");if(r){let d=r.querySelector(o?".form-error-message-sidebar":".form-error-message-fallback");if(!d){d=document.createElement("div"),d.className=o?"form-error-message-sidebar text-danger small pt-1":"form-error-message-fallback text-danger d-block small py-1";const f=i.closest(".input-group")||i;f.parentNode.insertBefore(d,f.nextSibling)}d&&(d.textContent=Array.isArray(e[t])?e[t][0]:e[t],a=!0)}}}}}export{b as a,y as c,p as d,u as g,g as s,s as t};
