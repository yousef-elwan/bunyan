import{S as l}from"./main-9Qm2jZ7z.js";import{g as f,t}from"./helpers-DwlY0Bzp.js";import{h}from"./api-C5g70RCE.js";import{m as E}from"./module.esm-Cm4okMZt.js";import"./index-xsH4HHeE.js";const m=h(),L=h({multipart:!0});E.data("profilePage",()=>({activeTab:"tab-personal-info",setActiveTab(c){if(this.activeTab=c,history.replaceState){const d=new URL(window.location);d.hash="#"+c,history.replaceState(null,null,d.toString())}else window.location.hash="#"+c},init(){const c=window.location.hash.substring(1);c&&["tab-personal-info","tab-security","tab-notifications","tab-preferences"].includes(c)&&(this.activeTab=c),S()}}));function S(){const c=(e,o)=>{g(e);for(const[s,n]of Object.entries(o)){const i=e.querySelector(`[name="${s}"]`),a=document.getElementById(`${s}_error`);i&&i.classList.add("border-danger","focus:border-danger","focus:ring-danger"),a&&n.length>0&&(a.textContent=n[0])}},d=()=>{const e=document.getElementById("avatarUpload"),o=document.getElementById("profileAvatarPreview");e&&o&&e.addEventListener("change",async function(s){var a,r;const n=s.target.files[0];if(!n)return;o.src=URL.createObjectURL(n);const i=new FormData;i.append("image",n);try{await L.post(f("api.auth.updateAvatar"),i),l.fire({icon:"success",title:t("success_title"),text:t("avatar_upload_success"),timer:1500,showConfirmButton:!1})}catch(u){l.fire({icon:"error",title:t("error_title"),text:((r=(a=u.response)==null?void 0:a.data)==null?void 0:r.message)||t("avatar_upload_error")})}})},p=(()=>{var s,n;const e=document.querySelector("#mobile");if(!e||typeof window.intlTelInput!="function")return null;const o=window.intlTelInput(e,{initialCountry:"auto",geoIpLookup:i=>fetch("https://ipapi.co/json").then(a=>a.json()).then(a=>i(a.country_code)).catch(()=>i("us")),utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",preferredCountries:["sy","sa","ae","eg","jo","lb"],separateDialCode:!0});return(n=(s=window.AppConfig)==null?void 0:s.user)!=null&&n.mobile&&o.setNumber(window.AppConfig.user.mobile),o})(),w=()=>{document.querySelectorAll(".password-toggle-icon").forEach(e=>{e.addEventListener("click",function(){const o=this.previousElementSibling;if(o){const s=o.getAttribute("type")==="password"?"text":"password";o.setAttribute("type",s),this.classList.toggle("fa-eye"),this.classList.toggle("fa-eye-slash")}})})},b=()=>{const e=document.getElementById("languageSelect");e&&e.addEventListener("change",function(){const o=this.value;l.fire({title:"Changing Language...",text:"Please wait.",allowOutsideClick:!1,didOpen:()=>l.showLoading()}),window.location.href=o})},g=e=>{e.querySelectorAll(".border-danger").forEach(o=>{o.classList.remove("border-danger","focus:border-danger","focus:ring-danger")}),e.querySelectorAll('[id$="_error"]').forEach(o=>{o.textContent=""})},y=()=>{const e=document.getElementById("updateInfoForm");e&&e.addEventListener("submit",async o=>{var n,i,a;o.preventDefault(),g(e);const s=e.querySelector('button[type="submit"]');if(p&&!p.isValidNumber()){l.fire({icon:"error",title:t("error_title"),text:t("invalid_phone")});return}s.disabled=!0,s.innerHTML=`<i class="fas fa-spinner fa-spin me-2"></i> ${t("saving")}`;try{const r=new FormData(e);p&&r.set("mobile",p.getNumber());const u=Object.fromEntries(r.entries());await m.post(f("api.auth.updateInfo"),u),l.fire({icon:"success",title:t("success_title"),text:t("info_update_success"),timer:1500,showConfirmButton:!1}),document.getElementById("profilePageNameDisplay").textContent=`${u.first_name} ${u.last_name}`,document.getElementById("profilePagePhoneDisplay").textContent=u.mobile}catch(r){((n=r.response)==null?void 0:n.status)===422?c(e,r.response.data.errors):l.fire({icon:"error",title:t("error_title"),text:((a=(i=r.response)==null?void 0:i.data)==null?void 0:a.message)||t("info_update_error")})}finally{s.disabled=!1,s.innerHTML=t("save")}})},_=()=>{const e=document.getElementById("updatePasswordForm");e&&e.addEventListener("submit",async o=>{var n,i,a;o.preventDefault();const s=e.querySelector('button[type="submit"]');s.disabled=!0,s.innerHTML=`<i class="fas fa-spinner fa-spin me-2"></i> ${t("updatingPassword")}`;try{const r=Object.fromEntries(new FormData(e).entries());if(r.new_password!==r.new_password_confirmation)throw new Error(t("password_mismatch"));await m.post(f("api.auth.updatePassword"),r),l.fire({icon:"success",title:t("success_title"),text:t("password_update_success"),timer:1500,showConfirmButton:!1}),e.reset()}catch(r){((n=r.response)==null?void 0:n.status)===422?c(e,r.response.data.errors):l.fire({icon:"error",title:t("error_title"),text:r.message||((a=(i=r.response)==null?void 0:i.data)==null?void 0:a.message)||t("password_update_error")})}finally{s.disabled=!1,s.innerHTML=t("changePassword")}})},v=()=>{const e=document.getElementById("notificationSettingsForm");e&&e.addEventListener("submit",async o=>{var n,i,a;o.preventDefault();const s=e.querySelector('button[type="submit"]');s.disabled=!0,s.innerHTML=`<i class="fas fa-spinner fa-spin me-2"></i> ${t("saving")}`;try{const r=new FormData(e),u=Object.fromEntries(r.entries());await m.post(f("api.auth.updateNotifications"),u),l.fire({icon:"success",title:t("success_title"),text:t("notifications_update_success"),timer:1500,showConfirmButton:!1})}catch(r){((n=r.response)==null?void 0:n.status)===422?c(e,r.response.data.errors):l.fire({icon:"error",title:t("error_title"),text:((a=(i=r.response)==null?void 0:i.data)==null?void 0:a.message)||t("notifications_update_error")})}finally{s.disabled=!1,s.innerHTML=t("save_settings")}})};d(),w(),b(),y(),_(),v()}
