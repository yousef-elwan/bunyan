import{t as e,a as ee,s as E,g as J,c as oe,d as Y}from"./helpers-DwlY0Bzp.js";import{h as se}from"./api-2skSE4Ue.js";import{i as ie,c as ae}from"./phoneInput-C4-BQoBS.js";import"./index-xsH4HHeE.js";function re(){console.log("[FavoriteAction] initFavoriteAction() CALLED");const n=document.querySelector(".favorite-btn-v3");if(!n){console.log("[FavoriteAction] No .favorite-btn-v3 found.");return}const o=n.dataset.propertyId,p=n.querySelector("i");p&&(n.classList.contains("active")?(p.classList.remove("far","fa-regular"),p.classList.add("fas","fa-solid"),n.dataset.tooltip=e("favorite_remove_tooltip")):(p.classList.remove("fas","fa-solid"),p.classList.add("far","fa-regular"),n.dataset.tooltip=e("favorite_add_tooltip"))),n.addEventListener("click",async()=>{if(console.log("[FavoriteAction] FavBtn clicked, PropID:",o),!window.AppConfig.isAuthenticated){ee();return}if(!o){E("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!window.AppConfig.csrfToken){E("error",{bodyHtml:e("csrf_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!J("properties.toggle-favorite")){E("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const c=J("properties.toggle-favorite").replace("{propertyId}",o),s=n.querySelector(".spinner-border"),l=n.querySelector(".btn-text"),f=l?l.textContent:"";n.disabled=!0,s&&s.classList.remove("d-none"),l&&e("loading_text")&&(l.textContent=e("loading_text"));try{const y=(await se({onStatusCodeError:{401:h=>{var d,H,k;const a=(H=(d=h==null?void 0:h.response)==null?void 0:d.data)==null?void 0:H.message;(k=E)==null||k("error",{bodyHtml:a||e("auth_required_message"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),n.disabled=!1,s&&s.classList.add("d-none"),l&&(l.textContent=f)}}}).post(c,{})).data;if(y.success===!0&&y.data){const h=y.data.is_active;n.classList.toggle("active",h),p&&(h?(p.classList.remove("far","fa-regular"),p.classList.add("fas","fa-solid"),n.dataset.tooltip=e("favorite_remove_tooltip")):(p.classList.remove("fas","fa-solid"),p.classList.add("far","fa-regular"),n.dataset.tooltip=e("favorite_add_tooltip"))),y.message&&E("success",{bodyHtml:y.message,timerSeconds:1,showCloseIcon:!0})}else E("error",{bodyHtml:y.message||e("favorite_action_failed"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(b){console.error("[FavoriteAction] Favorite API error:",b),E("error",{bodyHtml:e("network_error"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{n.disabled=!1,s&&s.classList.add("d-none"),l&&(l.textContent=f)}})}const le=document.querySelectorAll(".modal-v3");function ne(n){n&&(n.style.display="flex",document.body.style.overflow="hidden")}function te(n){n&&(n.style.display="none",document.body.style.overflow="")}function ce(){le.forEach(n=>{n.addEventListener("click",o=>{o.target===n&&te(n)})})}function de(){console.log("[BlacklistAction] initBlacklistAction() CALLED");const n=document.getElementById("blacklistConfirmModal"),o=document.querySelector(".blacklist-btn-trigger-v3");if(!o){console.log("[BlacklistAction] No .blacklist-btn-trigger-v3 found.");return}if(!n){console.warn("[BlacklistAction] .blacklist-btn-trigger-v3 found, but #blacklistConfirmModal not found.");return}const p=n.querySelector("[data-close-blacklist-modal]"),c=document.getElementById("confirmBlacklistBtn"),s=document.getElementById("cancelBlacklistBtn"),l=document.getElementById("blacklistConfirmMessage");let f=o.classList.contains("active");const b=o.dataset.propertyId;b||console.warn("[BlacklistAction] Blacklist button .blacklist-btn-trigger-v3 is missing data-property-id.");function y(){if(!o)return;const d=o.querySelector("i");o.classList.toggle("active",f),d&&d.classList.toggle("active-blacklist",f),o.dataset.tooltip=f?e("blacklist_remove_tooltip"):e("blacklist_add_tooltip")}function h(){if(!l||!c){console.error("[BlacklistAction] Blacklist modal essential elements (message/confirm button) missing."),E("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}l.textContent=f?e("blacklist_remove_confirm_message"):e("blacklist_add_confirm_message"),c.textContent=f?e("blacklist_confirm_remove_button"):e("blacklist_confirm_add_button");const d=n.querySelector(".modal-title");d&&(d.textContent=f?e("blacklist_remove_confirm_title"):e("blacklist_add_confirm_title")),ne(n),n.style.display="flex"}function a(){if(n.style.display="none",c){c.disabled=!1;const d=c.querySelector(".spinner-border");d&&d.classList.add("d-none")}te(n)}y(),o.addEventListener("click",()=>{if(console.log("[BlacklistAction] BlacklistBtn clicked, PropID:",b),!window.AppConfig.isAuthenticated){ee();return}if(!b){E("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}h()}),p&&p.addEventListener("click",a),s&&s.addEventListener("click",a),n.addEventListener("click",d=>{d.target===n&&a()}),document.addEventListener("keydown",d=>{d.key==="Escape"&&n.style.display==="flex"&&a()}),c?c.addEventListener("click",async()=>{if(!window.AppConfig.isAuthenticated){ee(),a();return}if(!b){E("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),a();return}if(!window.AppConfig.csrfToken){E("error",{bodyHtml:e("csrf_error"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),a();return}if(!J("properties.toggle-blacklist")){E("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),a();return}const d=J("properties.toggle-blacklist").replace("{propertyId}",b),H=c.querySelector(".spinner-border");c.disabled=!0,H&&H.classList.remove("d-none");try{const A=(await se({onStatusCodeError:{401:q=>{var B,v,w;const C=(v=(B=q==null?void 0:q.response)==null?void 0:B.data)==null?void 0:v.message;(w=E)==null||w("error",{bodyHtml:C||e("auth_required_message"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),a()}}}).post(d,{})).data;A.success===!0&&A.data?(f=A.data.is_active,y(),E("success",{bodyHtml:A.message,timerSeconds:1,showCloseIcon:!0})):E("error",{bodyHtml:A.message||e("blacklist_action_failed"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(k){console.error("[BlacklistAction] Blacklist API error:",k),E("error",{bodyHtml:e("network_error"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{a()}}):console.error("[BlacklistAction] Critical: #confirmBlacklistBtn not found inside #blacklistConfirmModal.")}function ue(){console.log("[ReportAction] initReportAction() CALLED");const n=document.getElementById("reportPropertyModal"),o=document.getElementById("reportFormV3"),p=document.querySelectorAll(".report-btn-trigger-v3");if(p.length===0){console.log("[ReportAction] No .report-btn-trigger-v3 buttons found."),n&&console.warn("[ReportAction] #reportPropertyModal exists, but no .report-btn-trigger-v3 found.");return}if(!n){console.warn("[ReportAction] .report-btn-trigger-v3 found, but #reportPropertyModal is missing.");return}o||console.warn("[ReportAction] #reportPropertyModal found, but #reportFormV3 is missing.");const c=n.querySelector("[data-close-report-modal]");let s=null;const l=document.getElementById("reportUserName"),f=document.getElementById("reportUserEmail"),b=document.getElementById("reportUserMobile"),y=document.getElementById("closeReportBtn"),h=n.querySelectorAll(".user-details-group"),a=window.AppConfig.user,d=(a==null?void 0:a.mobile)||"",H=ie(b,d),k=ae(H,b,o.querySelector('.invalid-feedback[data-field="mobile"]'),e);k.setupEventListeners();function A(C){s=C,o&&(o.reset(),oe(o,["reason","details","name","email","mobile"]),window.AppConfig.isAuthenticated?h.forEach(B=>B.style.display="none"):o.classList.contains("allow-guest-submission")?(h.forEach(B=>B.style.display="block"),l&&(l.readOnly=!1),f&&(f.readOnly=!1),b&&(b.readOnly=!1)):h.forEach(B=>B.style.display="none")),ne(n),n.style.display="flex"}function q(){if(n.style.display="none",s=null,o){const C=o.querySelector('button[type="submit"]');C&&(C.disabled=!1,C.textContent=e("report_submit_button_text")||"Submit Report")}te(n)}p.forEach(C=>{C.addEventListener("click",function(){const B=this.dataset.propertyId;console.log("[ReportAction] OpenReportBtn clicked, data-property-id:",B);const v=this.classList.contains("allow-guest-report")||o&&o.classList.contains("allow-guest-submission");if(!window.AppConfig.isAuthenticated&&!v){ee();return}if(B)A(B);else{const w=J("properties.submit-report");let x=null;if(w&&typeof w=="string"&&!w.includes("{propertyId}")){const S=w.match(/\/properties\/(\d+)\/submit-report/);S&&S[1]&&(x=S[1])}x?(console.warn("[ReportAction] Report button missing data-property-id, inferred from global API URL:",x),A(x)):(console.error("[ReportAction] Report button missing data-property-id and could not infer. Cannot open report dialog."),E("error",{title:e("error_title"),bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}))}})}),c&&c.addEventListener("click",q),n.addEventListener("click",C=>{C.target===n&&q()}),y.addEventListener("click",C=>{q()}),document.addEventListener("keydown",C=>{C.key==="Escape"&&n.style.display==="flex"&&q()}),o&&o.addEventListener("submit",async C=>{var W,D;if(C.preventDefault(),console.log("[ReportAction] Report form submitted for propertyId:",s),!s){E("error",{title:e("error_title"),bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const B=o.classList.contains("allow-guest-submission");if(!window.AppConfig.isAuthenticated&&!B){ee();return}if(!window.AppConfig.csrfToken){E("error",{title:e("error_title"),bodyHtml:e("csrf_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!J("properties.submit-report")){E("error",{title:e("error_title"),bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const v=o.querySelector('button[type="submit"]'),w=v?v.textContent:e("report_submit_button_text");v&&(v.disabled=!0,v.textContent=e("submitting")),oe(o,["reason","details","name","email","mobile"]);const x=new FormData(o),S={reason:x.get("reportReason")||"",details:x.get("reportDetails")||""};if(!window.AppConfig.isAuthenticated&&B){S.name=(l==null?void 0:l.value)||"",S.email=(f==null?void 0:f.value)||"";const M=x.get("mobile");let r=M;if(k&&M&&M.trim()!==""&&!k.validate()){Y(o,{mobile:[e("phone_invalid")]},!0),E("error",{bodyHtml:e("phone_invalid"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),v&&(v.disabled=!1,v.textContent=w);return}(W=k.getInstance())!=null&&W.isValidNumber()?r=((D=k.getInstance())==null?void 0:D.getNumber())||M:(!M||M.trim()==="")&&(r=""),S.mobile=r}try{const M=await fetch(J("properties.submit-report"),{method:"POST",headers:{"X-CSRF-TOKEN":window.AppConfig.csrfToken,Accept:"application/json","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify(S)}),r=await M.json();M.ok&&r.success===!0?(q(),E("success",{bodyHtml:r.message||e("report_submit_success"),timerSeconds:1,showCloseIcon:!0})):M.status===422&&r.errors?(Y(o,r.errors,!1),E("error",{bodyHtml:r.message||e("validation_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})):M.status===401?E("error",{bodyHtml:r.message||e("auth_required_message"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}):E("error",{bodyHtml:r.message||e("report_submit_failed"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(M){console.error("[ReportAction] Report API submission error:",M),E("error",{bodyHtml:e("network_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{v&&(v.disabled=!1,v.textContent=w)}})}function pe(){const n=window.AppConfig.user,o=(n==null?void 0:n.name)||"",p=(n==null?void 0:n.email)||"",c=(n==null?void 0:n.mobile)||"",s=document.getElementById("contactAgentFormV3"),l=document.getElementById("agentContactPhoneV3"),f=window.AppConfig.pageData.owner.mobile,b=ie(l,c),y=ae(b,l,s.querySelector('.invalid-feedback[data-field="mobile"]'),e);if(y.setupEventListeners(),!window.AppConfig.isAuthenticated){const a=s.querySelector('input[name="name"]'),d=s.querySelector('input[name="email"]');a&&!a.value&&o&&(a.value=o),d&&!d.value&&p&&(d.value=p)}s.addEventListener("submit",async a=>{var B,v,w,x,S,W;if(a.preventDefault(),!window.AppConfig.csrfToken){E("error",{bodyHtml:e("csrf_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!J("properties.submit-report")){E("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const d=s.querySelector('button[type="submit"]'),H=d?d.textContent:e("contact_agent_send_button_text");d&&(d.disabled=!0,d.textContent=e("loading_text")),oe(s,["name","email","mobile","message"]);const k=new FormData(s),A=k.get("mobile");let q=A;if(y){if(A&&A.trim()!==""&&!y.validate()){Y(s,{mobile:[e("phone_invalid")]},!0),E("error",{bodyHtml:e("phone_invalid"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),d&&(d.disabled=!1,d.textContent=H);return}(B=y.getInstance())!=null&&B.isValidNumber()?q=((v=y.getInstance())==null?void 0:v.getNumber())||A:(!A||A.trim()==="")&&(q="")}const C={name:k.get("name"),email:k.get("email"),mobile:A,userPhoneFull:q,message:k.get("message")};try{const M=(await se({onStatusCodeError:{401:r=>{var I,V,F;const _=(V=(I=r==null?void 0:r.response)==null?void 0:I.data)==null?void 0:V.message;(F=E)==null||F("error",{bodyHtml:_||e("auth_required_message"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),d&&(d.disabled=!1,d.textContent=H)},422:r=>{var P,K,X,N,z;const _=(K=(P=r==null?void 0:r.response)==null?void 0:P.data)==null?void 0:K.message,I=(N=(X=r==null?void 0:r.response)==null?void 0:X.data)==null?void 0:N.errors;let V=e("error_title"),F="",U="";if(I&&Object.keys(I).length>0){Y?Y(s,I):console.warn("[ContactAgentAction] displayActionFormErrors helper not available to show inline errors."),V=e("validation_error_title"),U=`<ul style="text-align: ${window.AppConfig.isRTL?"right":"left"}; list-style-position: inside; padding-${window.AppConfig.isRTL?"right":"left"}: 0; margin:0;">`;for(const Z in I)I[Z].forEach(t=>U+=`<li style="margin-bottom: 5px;">${t}</li>`);U+="</ul>",F=e("validation_error_summary")+"<br>"+U}else _?F=_:F=e("generic_error_try_again");d&&(d.disabled=!1,d.textContent=H),(z=E)==null||z("error",{title:V,bodyHtml:F,buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}}}).post(J("properties.contact-agent"),C)).data;if(d&&(d.disabled=!1,d.textContent=H),(w=E)==null||w("success",{bodyHtml:M.message||e("contact_message_sent_success"),timerSeconds:1,showCloseIcon:!0}),s.reset(),!window.AppConfig.isAuthenticated){const r=s.querySelector('input[name="name"]'),_=s.querySelector('input[name="email"]');r&&o&&(r.value=o),_&&p&&(_.value=p),y&&!window.AppConfig.isAuthenticated&&c?(x=y.getInstance())==null||x.setNumber(c):l&&!window.AppConfig.isAuthenticated&&c?l.value=c:y&&((S=y.getInstance())==null||S.setNumber(""))}}catch(D){console.error("[ContactAgentAction] Contact Agent API error:",D),d&&(d.disabled=!1,d.textContent=H),(W=E)==null||W("error",{bodyHtml:e("network_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{d&&(d.disabled=!1,d.textContent=H)}});const h=document.getElementById("whatsappLinkV3");if(h&&typeof h<"u"&&typeof f<"u"){let a=s.querySelector('[name="message"]').value;a=encodeURIComponent(a);const d=f.replace(/\D/g,"");h.href=`https://wa.me/${d}?text=${a}`}}function me(){const n=document.getElementById("showMobileModal"),o=document.querySelector("[data-close-mobile-modal]"),p=document.getElementById("agentMobileNumberDisplay"),c=document.getElementById("callAgentLink"),s=document.getElementById("copyMobileNumberBtnV3");function l(h,a,d,H,k){!h||!a||navigator.clipboard.writeText(a).then(()=>{h.classList.add("copied"),k&&k.classList.add("show"),h.disabled=!0,setTimeout(()=>{h.classList.remove("copied"),k&&k.classList.remove("show"),h.disabled=!1;const A=h.querySelector("i");A&&!h.classList.contains("copied")&&(A.className="far fa-copy")},2e3)}).catch(A=>{console.error("Clipboard copy failed: ",A),alert(e("copy_fail"))})}function f(){const h=window.AppConfig.pageData.owner.mobile;if(n){if(p&&(p.textContent=e("agent_number"),setTimeout(()=>{typeof h<"u"&&h?(p.textContent=h,c&&(c.href=`tel:${h}`),s&&(s.style.display="flex"),c&&(c.style.display="inline-flex")):(p.textContent=e("number_not_found"),c&&(c.style.display="none"),s&&(s.style.display="none"))},200)),s){s.classList.remove("copied"),s.disabled=!1;const a=s.querySelector("i");a&&(a.className="far fa-copy");const d=s.querySelector(".copied-feedback-v3");d&&d.classList.remove("show")}ne(n)}}function b(){te(n)}function y(){const h=document.querySelector(".show-mobile-btn");h&&h.addEventListener("click",f),o&&o.addEventListener("click",b),s&&p&&s.addEventListener("click",()=>{const a=p.textContent.replace(/\s+/g,"");a&&a!==e("loading_text")&&a!==e("number_not_found")&&l(s,a,null,null,s.querySelector(".copied-feedback-v3"))})}y()}function fe(){const n=document.getElementById("sharePropertyModal"),o=document.querySelector(".share-btn-trigger-v3"),p=document.querySelector("[data-close-share-modal]"),c=document.getElementById("propertyShareLink"),s=document.getElementById("copyShareLinkBtn"),l=s?s.querySelector(".copy-btn-text"):null,f=document.getElementById("shareViaWhatsApp"),b=document.getElementById("shareViaTwitter"),y=document.getElementById("shareViaFacebook"),h=document.getElementById("shareViaEmail"),a=document.getElementById("shareViaLinkedIn"),d=document.getElementById("shareViaTelegram");function H(C,B,v,w,x){!C||!B||navigator.clipboard.writeText(B).then(()=>{C.classList.add("copied"),v&&(v.textContent=w),C.disabled=!0,setTimeout(()=>{C.classList.remove("copied"),v&&(v.textContent=C.id==="copyShareLinkBtn"?e("copy_link"):e("copy_number")),C.disabled=!1;const S=C.querySelector("i");S&&!C.classList.contains("copied")&&(S.className="far fa-copy")},2e3)}).catch(S=>{console.error("Clipboard copy failed: ",S),alert(C.id==="copyShareLinkBtn"?e("copy_fail"):e("copy_fail"))})}function k(){if(!n)return;const C=window.location.href;let B=document.title;const v=document.querySelector(".property-intro-v3 .title-location-v3 h1");v&&(B=v.textContent.trim()),c&&(c.value=C);const w=encodeURIComponent(C),x=encodeURIComponent(B);if(f&&(f.href=`https://wa.me/?text=${x}%20-%20${w}`),b&&(b.href=`https://twitter.com/intent/tweet?url=${w}&text=${x}`),y&&(y.href=`https://www.facebook.com/sharer/sharer.php?u=${w}`),h&&(h.href=`mailto:?subject=${x}&body=Check%20out%20this%20property:%20${w}`),a&&(a.href=`https://www.linkedin.com/sharing/share-offsite/?url=${w}`),d&&(d.href=`https://t.me/share/url?url=${w}&text=${x}`),s){s.classList.remove("copied"),s.disabled=!1,l&&(l.textContent=e("copy_link"));const S=s.querySelector("i");S&&(S.className="far fa-copy")}ne(n)}function A(){te(n)}function q(){o&&(o.addEventListener("click",k),p&&p.addEventListener("click",A),s&&c&&l&&s.addEventListener("click",()=>{H(s,c.value,l,e("copy_success"))}))}q()}function ge(){const n=document.getElementById("seeMoreBtnV3"),o=document.getElementById("descriptionContentV3");n&&o&&n.addEventListener("click",()=>{o.classList.toggle("expanded-v3"),n.textContent=o.classList.contains("expanded-v3")?e("show_less"):e("show_more")})}function ye(){const n=(window.AppConfig.pageData.amenities||[]).map(function(f){return{name:f,icon:""}}),o=window.AppConfig.pageData.nearby_places||[],p=(window.AppConfig.pageData.attributes||[]).map(function(f){return{key:f.name,value:f.value,icon:""}}),c=document.getElementById("propertyAttributesListV3");c&&typeof p<"u"&&typeof ATTRIBUTE_ICON_MAP_V3<"u"&&(c.innerHTML="",p.forEach(f=>{const b=document.createElement("li"),y=f.icon||ATTRIBUTE_ICON_MAP_V3[f.key]||ATTRIBUTE_ICON_MAP_V3.default;b.innerHTML=`<i class="fas ${y}"></i> <strong>${f.key||e("attribute_default_name")}:</strong> <span>${f.value||"-"}</span>`,c.appendChild(b)}));const s=document.getElementById("amenitiesListV3");s&&typeof n<"u"&&(s.innerHTML="",n.forEach(f=>{const b=document.createElement("li");b.innerHTML=`<i class="fas ${f.icon||"fa-check-square"}"></i> <span>${f.name||e("aminity_default_name")}</span>`,s.appendChild(b)}));const l=document.getElementById("nearestPlacesListV3");l&&typeof NEAREST_PLACES_DATA_V3<"u"&&typeof PLACE_ICON_MAP_V3<"u"&&(l.innerHTML="",o.forEach(f=>{const b=document.createElement("li"),y=f.icon||PLACE_ICON_MAP_V3[f.type]||PLACE_ICON_MAP_V3.default;b.innerHTML=`<i class="fas ${y}"></i> <span>${f.name||e("nearby_place_default_name")}</span> <span class="place-distance-v3">(${f.distance||""})</span>`,l.appendChild(b)}))}function he(){const n=document.getElementById("floatingContactBtnV3"),o=document.querySelector(".agent-contact-card-v3");function p(s){if(!s)return!1;const l=s.getBoundingClientRect(),f=l.top<window.innerHeight&&l.bottom>=0,b=l.left<window.innerWidth&&l.right>=0;return f&&b}function c(){if(!n)return;p(o)?n.classList.remove("visible"):n.classList.add("visible")}n&&(document.querySelector(".agent-contact-card-v3")?(window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c),c()):console.warn("Agent contact card not found for floating button visibility logic. Button may not behave as expected."),n.addEventListener("click",()=>{const s=document.querySelector(".agent-contact-card-v3");s?s.scrollIntoView({behavior:"smooth",block:"center"}):alert(e("contact_us_action"))}))}function ve(){const n=document.querySelector(".hero-swiper-section-v3"),o=document.querySelector(".hero-swiper"),p=document.getElementById("heroSwiperWrapperV3"),c=document.getElementById("thumbnailContainerV3"),s=document.getElementById("swiperProgressV3");let l=null;const f=991,b=1399,y=2,h=4,a=(AppConfig.pageData.images||[]).map(function(r){return{src:r,thumb:r,caption:""}});if(!n||!o||!p||!c||!s){console.error("Gallery init failed: Essential HTML elements for hero gallery missing.");return}if(typeof a>"u"||!Array.isArray(a)){console.error("Gallery init failed: images is not defined or not an array."),p&&(p.innerHTML='<p style="text-align:center; padding: 20px;">'+e("no_images_to_display")+"</p>");return}if(a.length===0){p&&(p.innerHTML='<p style="text-align:center; padding: 20px;">'+e("no_images_to_display")+"</p>"),c&&(c.style.display="none"),s&&(s.style.display="none");return}const d=a.map(r=>({src:r.src,thumb:r.thumb,caption:r.caption||""}));function H(){l&&(l.destroy(!0,!0),l=null)}function k(r){r.classList.remove("loading"),r.classList.add("loaded")}function A(r){r.classList.remove("loading"),r.classList.add("error");const _=r.closest("a");_&&_.classList.add("img-error"),console.warn("Image failed to load:",r.src||r.dataset.srcLarge)}function q(r=0){typeof Fancybox<"u"&&d.length>0?Fancybox.show(d,{startIndex:r,Hash:!1,Toolbar:{display:{left:["infobar"],middle:[],right:["slideshow","thumbs","fullscreen","close"]}},Thumbs:{autoStart:!0,type:"classic"},Carousel:{infinite:a.length>1},on:{selectSlide:(_,I,V)=>{l&&o.classList.contains("slider-layout-active")&&V&&typeof V.index<"u"&&l.slideToLoop(V.index)}}}):console.error("Fancybox library not loaded or no gallery items for Fancybox.")}function C(r,_,I,V=!1,F=""){const U=document.createElement("a");U.href=r.src,U.dataset.caption=r.caption||`Image ${_+1}`;const P=document.createElement("img");return P.alt=r.caption||`Image ${_+1}`,P.loading="lazy",P.classList.add("loading"),!I&&_===0?P.src=r.src:(P.src=r.thumb,I&&(P.dataset.srcLarge=r.src)),P.addEventListener("load",function(){I&&this.dataset.srcLarge&&this.src!==this.dataset.srcLarge?this.src=this.dataset.srcLarge:k(this)}),P.addEventListener("error",function(){A(this)}),U.appendChild(P),U.addEventListener("click",K=>{K.preventDefault(),q(_)}),V&&(U.dataset.morePhotosText=F),U}function B(r){if(p.innerHTML="",c&&(c.innerHTML=""),a.length!==0)if(r)a.forEach((_,I)=>{const V=document.createElement("div");if(V.classList.add("swiper-slide"),V.appendChild(C(_,I,!0)),p.appendChild(V),c){const F=document.createElement("img");F.src=_.thumb,F.alt=`Thumbnail ${I+1}`,F.loading="lazy",F.classList.add("thumbnail-v3","loading"),F.dataset.index=I,F.addEventListener("load",function(){k(this)}),F.addEventListener("error",function(){A(this)}),F.onclick=()=>{l&&l.slideToLoop(I)},c.appendChild(F)}});else{const _=a[0],I=document.createElement("div");if(I.classList.add("swiper-slide","grid-main-image"),I.appendChild(C(_,0,!1)),p.appendChild(I),a.length>1){const V=document.createElement("div");V.classList.add("small-images-grid");const F=innerWidth>b,U=F?h:y,P=a.length-1,K=Math.min(P,U);let X=[];for(let N=0;N<K;N++){const z=N+1,Z=a[z],t=N===K-1,u=P>U,i=t&&u;let m="";if(i){const R=P-K;m=`+${e("more_photos_overlay",{count:R})}`}const g=document.createElement("div");g.classList.add("swiper-slide"),i&&g.classList.add("has-more-photos-overlay"),g.appendChild(C(Z,z,!1,i,m)),X.push(g)}if(F&&X.length>=3&&U===4){const N=document.createElement("div");N.classList.add("small-image-row");const z=document.createElement("div");z.classList.add("small-image-row"),X.forEach((Z,t)=>t<2?N.appendChild(Z):z.appendChild(Z)),N.hasChildNodes()&&V.appendChild(N),z.hasChildNodes()&&V.appendChild(z)}else X.forEach(N=>V.appendChild(N));V.hasChildNodes()&&p.appendChild(V)}}}function v(r){if(s&&r&&r.slides&&r.slides.length>0&&a.length>0){const _=r.realIndex!==void 0?r.realIndex+1:1;s.textContent=`${_} / ${a.length}`}else s&&(s.textContent="")}function w(){const r=innerWidth;H(),n.classList.add("layout-changing"),o.className="swiper hero-swiper",c&&(c.style.display="none"),s&&(s.style.display="none");const _=r<=f||a.length<=1;if(n.classList.toggle("grid-active-section",!_),n.classList.toggle("slider-active-section",_),_){if(o.classList.add("slider-layout-active"),c&&a.length>1&&(c.style.display="flex"),s&&a.length>0&&(s.style.display="block"),B(!0),typeof Swiper<"u"&&a.length>0){if(l=new Swiper(o,{loop:a.length>1,slidesPerView:1,spaceBetween:10,pagination:{el:".swiper-pagination-slider",clickable:!0,dynamicBullets:a.length>5},navigation:{nextEl:".swiper-button-next-slider",prevEl:".swiper-button-prev-slider"},on:{init:v,slideChange:function(I){if(c){c.querySelectorAll(".thumbnail-v3").forEach(F=>F.classList.remove("active"));const V=c.querySelector(`.thumbnail-v3[data-index="${I.realIndex}"]`);V&&V.classList.add("active")}v(I)}}}),c&&a.length>1){const I=c.querySelector('.thumbnail-v3[data-index="0"]');I&&I.classList.add("active")}l&&v(l)}}else o.classList.add("grid-layout-active"),B(!1),o.classList.toggle("large-grid",r>b),o.classList.toggle("medium-grid",r>f&&r<=b),p.querySelectorAll(".swiper-slide:not(.has-more-photos-overlay) > a").forEach(I=>{I.addEventListener("mouseenter",()=>{o.classList.contains("grid-layout-active")&&o.classList.add("grid-hover-active")}),I.addEventListener("mouseleave",()=>{o.classList.contains("grid-layout-active")&&o.classList.remove("grid-hover-active")})});setTimeout(()=>n.classList.remove("layout-changing"),100)}const x=document.getElementById("floatingContactBtnV3"),S=document.querySelector(".agent-contact-card-v3");function W(r){if(!r)return!1;const _=r.getBoundingClientRect();return _.top<innerHeight&&_.bottom>=0&&_.left<innerWidth&&_.right>=0}function D(){if(!x)return;W(S)?x.classList.remove("visible"):x.classList.add("visible")}x&&(S&&(addEventListener("scroll",D,{passive:!0}),addEventListener("resize",D)),setTimeout(D,150),x.addEventListener("click",()=>{const r=document.querySelector(".agent-contact-card-v3");r?r.scrollIntoView({behavior:"smooth",block:"center"}):alert("Contact section not found.")})),w();let M;addEventListener("resize",()=>{clearTimeout(M),M=setTimeout(w,250)})}function be(){const n=document.getElementById("tabsWrapperV3"),o=document.getElementById("tabButtonsContainerV3"),p=document.getElementById("scrollTabsLeftBtn"),c=document.getElementById("scrollTabsRightBtn"),s=document.querySelectorAll(".tab-button-v3"),l=document.querySelectorAll(".tab-content-v3");if(!n||!o)return;s.length>0&&l.length>0&&s.forEach(y=>{y.addEventListener("click",()=>{const h=y.dataset.tab;s.forEach(a=>a.classList.remove("active")),y.classList.add("active"),l.forEach(a=>{a.classList.remove("active"),a.id===h+"ContentV3"&&a.classList.add("active")})})}),p&&c&&(p.addEventListener("click",()=>{const y=o.clientWidth*.75;o.scrollBy({left:-y,behavior:"smooth"})}),c.addEventListener("click",()=>{const y=o.clientWidth*.75;o.scrollBy({left:y,behavior:"smooth"})}));function f(){if(!n)return;const h=document.documentElement.getAttribute("dir")==="rtl"?-o.scrollLeft:o.scrollLeft,a=o.scrollWidth-o.clientWidth,d=10;h>d?n.classList.add("show-scroll-hint-start"):n.classList.remove("show-scroll-hint-start"),h<a-d?n.classList.add("show-scroll-hint-end"):n.classList.remove("show-scroll-hint-end")}function b(){requestAnimationFrame(()=>{o.scrollWidth>o.clientWidth+1?(n.classList.add("is-scrollable"),f()):n.classList.remove("is-scrollable","show-scroll-hint-start","show-scroll-hint-end")})}setTimeout(b,150),o.addEventListener("scroll",f,{passive:!0}),window.addEventListener("resize",b)}function Le(){const n=document.getElementById("videoPlaceholderV3");n&&window.AppConfig.pageData.video_url&&n.addEventListener("click",()=>{typeof Fancybox<"u"?Fancybox.show([{src:window.AppConfig.pageData.video_url+"?autoplay=1",type:"iframe",preload:!1,iframe:{attr:{allow:"autoplay; fullscreen",allowfullscreen:!0}}}]):(alert(__("video_not_available")),console.warn("Fancybox not loaded. Video cannot be opened in a modal."))})}function we(){const n='<span class="loading-spinner-container"><i class="fas fa-spinner loading-spinner-v3"></i></span>',o="initialCommentLoadingMessageV3";function p(t,u,i=null){t&&(u?(t.dataset.originalContent||(t.dataset.originalContent=t.innerHTML),t.innerHTML=n,t.classList.add("loading"),t.disabled=!0):(i!==null?t.innerHTML=i:t.dataset.originalContent&&(t.innerHTML=t.dataset.originalContent),(t.innerHTML===n||t.innerHTML==="")&&(t.classList.contains("load-more-comments-v3")||t.id==="loadMoreCommentsV3"?t.innerHTML='<span class="btn-text">'+e("load_more")+"</span>":t.type==="submit"&&(t.innerHTML='<span class="btn-text">'+e("send")+"</span>")),t.classList.remove("loading"),t.disabled=!1,delete t.dataset.originalContent))}const c=document.querySelectorAll(".community-tab-button-v3"),s=document.querySelectorAll(".community-tab-content-v3"),l=document.getElementById("addCommentFormV3");c.forEach(t=>{t.addEventListener("click",u=>{c.forEach(m=>m.classList.remove("active")),t.classList.add("active");const i=t.dataset.tab;s.forEach(m=>{m.classList.remove("active"),m.id===i&&m.classList.add("active")}),l&&!u.target.classList.contains("btn-add-review-v3")&&!l.contains(u.target)&&l.classList.contains("active")&&l.classList.remove("active")})});const f=document.querySelectorAll(".faq-item-v3");f.forEach(t=>{const u=t.querySelector(".faq-question-v3"),i=t.querySelector(".faq-answer-v3");u&&i&&u.addEventListener("click",()=>{const m=t.classList.contains("active");f.forEach(g=>{if(g!==t&&g.classList.contains("active")){g.classList.remove("active");const R=g.querySelector(".faq-answer-v3");R&&(R.style.maxHeight=null)}}),m?(t.classList.remove("active"),i.style.maxHeight=null):(t.classList.add("active"),i.style.maxHeight=i.scrollHeight+"px")})});function b(t,u){document.querySelectorAll(t).forEach(m=>{const g=m.id==="formStarRatingV3"?document.getElementById("userRatingInputV3"):m.nextElementSibling;if(!g){console.warn("Star rating hidden input not found for container:",m);return}const R=m.querySelectorAll("i");R.forEach(O=>{O.addEventListener("click",function(){const T=this.dataset.value;g.value=T,y(R,T)}),O.addEventListener("mouseover",function(){y(R,this.dataset.value,!0)}),O.addEventListener("mouseout",function(){y(R,g.value)})})})}function y(t,u,i=!1){t.forEach(m=>{const g=parseInt(m.dataset.value);m.classList.remove("fas","far","selected","hovered"),g<=parseInt(u)?(m.classList.add("fas"),i?m.classList.add("hovered"):m.classList.add("selected")):m.classList.add("far")})}function h(t){if(!t)return;t.querySelectorAll("i").forEach(i=>{i.classList.remove("fas","selected","hovered"),i.classList.add("far")})}document.getElementById("formStarRatingV3")&&document.getElementById("userRatingInputV3")&&b("#formStarRatingV3");const a=document.getElementById("averageRatingValueV3"),d=document.getElementById("averageStarsDisplayV3"),H=document.getElementById("averageRatingTotalReviewsV3"),k=document.getElementById("totalRatingCountV3"),A=document.getElementById("ratingBreakdownContainerV3");let q={average:0,totalReviews:0,breakdown:[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}]};function C(t){if(!t||t.length===0)return{average:0,totalReviews:0,breakdown:[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}]};let u=0,i=0;const m=[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}];function g(O){O.forEach(T=>{T.rating&&T.rating>0&&T.parentId===null&&(u+=T.rating,i++,T.rating>=1&&T.rating<=5&&m[5-T.rating].count++)})}return g(t),{average:i>0?u/i:0,totalReviews:i,breakdown:m}}function B(){if(q=C(D),a&&(a.textContent=q.average.toFixed(1)),H&&(H.textContent=q.totalReviews),k&&(k.textContent=q.totalReviews),d){d.innerHTML="";let t=q.average;for(let u=1;u<=5;u++){const i=document.createElement("i");t>=.75?(i.className="fas fa-star",t--):t>=.25?(i.className="fas fa-star-half-alt",t=0):i.className="far fa-star",d.appendChild(i)}}A&&(A.innerHTML="",q.breakdown.forEach(t=>{const u=q.totalReviews>0?t.count/q.totalReviews*100:0,i=document.createElement("div");i.className="rating-bar-row-v3",i.innerHTML=`<span>${t.stars} ${t.stars===1?e("star_1"):t.stars===2?e("star_2"):e("stars")}</span><div class="rating-bar-v3"><div class="rating-bar-filled-v3" style="width: ${u.toFixed(1)}%;"></div></div><span>(${t.count})</span>`,A.appendChild(i)}))}const v=document.getElementById("commentListV3"),w=document.getElementById("loadMoreCommentsV3"),x=document.getElementById("noMoreCommentsMessageV3"),S=document.getElementById("totalCommentCountV3");let W=null,D=[{id:1,author:"أحمد محمد",avatar:"https://placehold.co/36x36/778899/FFFFFF?text=A",rating:5,text:`فيلا رائعة جداً!
الموقع ممتاز والتشطيبات فاخرة.
أنصح بها بشدة للعائلات الكبيرة.`,date:"منذ يومين",parentId:null,replies:[{id:101,author:"مجموعة الثقة (الوكيل)",avatar:"https://placehold.co/32x32/0062cc/FFFFFF?text=و",rating:0,text:"شكراً جزيلاً لتقييمك الرائع أستاذ أحمد! نسعد بخدمتك.",date:"منذ يوم",parentId:1,replies:[]}]},{id:2,author:"سارة علي",avatar:"https://placehold.co/36x36/AACCFF/000000?text=S",rating:4,text:"تجربة جيدة بشكل عام، بعض الملاحظات البسيطة على الصيانة ولكن السعر مناسب.",date:"منذ أسبوع",parentId:null,replies:[{id:201,author:"مجموعة الثقة (الوكيل)",avatar:"https://placehold.co/32x32/0062cc/FFFFFF?text=و",rating:0,text:"شكراً لملاحظاتك سارة، نعمل على تحسين خدمات الصيانة باستمرار.",date:"منذ 6 أيام",parentId:2,replies:[]}]},{id:3,author:"خالد عبدالله",avatar:"https://placehold.co/36x36/FFD700/000000?text=K",rating:5,text:"كل شيء كان مثالياً، من الحجز إلى المغادرة. خدمة العملاء ممتازة.",date:"منذ 3 أسابيع",parentId:null,replies:[]},{id:4,author:"نورة إبراهيم",avatar:"https://placehold.co/36x36/E6E6FA/000000?text=N",rating:3,text:"الموقع جيد ولكن الأثاث يحتاج إلى تحديث بسيط. السعر معقول.",date:"منذ شهر",parentId:null,replies:[{id:102,author:"أحمد محمد",avatar:"https://placehold.co/32x32/778899/FFFFFF?text=A",rating:0,text:"أتفق معكِ بشأن الأثاث، لكن الموقع يعوض ذلك.",date:"منذ 3 أسابيع",parentId:4,replies:[{id:103,author:"نورة إبراهيم",avatar:"https://placehold.co/30x30/E6E6FA/000000?text=N",rating:0,text:"صحيح، سأفكر في الأمر مرة أخرى.",date:"منذ أسبوعين",parentId:102,replies:[]}]}]},{id:5,author:"عمر ياسين",avatar:"https://placehold.co/36x36/228B22/FFFFFF?text=O",rating:4,text:"المكان نظيف وهادئ جداً، مثالي للاسترخاء. الواي فاي كان ضعيفاً بعض الشيء.",date:"منذ شهرين",parentId:null,replies:[]},{id:6,author:"فاطمة حسن",avatar:"https://placehold.co/36x36/FFC0CB/000000?text=F",rating:5,text:"أفضل إقامة قضيتها على الإطلاق! الموظفون ودودون والمرافق ممتازة.",date:"منذ 3 شهور",parentId:null,replies:[]}],M=0;const r=2;function _(t,u=0){const i=document.createElement("div");i.className="comment-item-v3",i.dataset.commentId=t.id;const m=u*25,g=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft";u>0&&(i.style[g]=`${m}px`);let R="";if(t.rating&&t.rating>0)for(let G=1;G<=5;G++)R+=`<i class="${G<=t.rating?"fas":"far"} fa-star"></i>`;const O=Math.max(24,36-u*4);let T="";if(t.replies&&t.replies.length>0&&u<2){const G=t.replies.length===1?e("replay_1"):t.replies.length===2?e("replay_2"):`${t.replies.length} `+e("replaies");T=`<button class="comment-action-btn-v3 btn-view-replies" data-comment-id="${t.id}"><i class="fas fa-comments"></i> ${G}</button>`}i.innerHTML=`
            <div class="comment-author-v3">
                <img src="${t.avatar}" alt="${t.author}" class="comment-avatar-v3" style="width:${O}px; height:${O}px;">
                <div>
                    <span class="comment-author-name-v3">${t.author}</span>
                    ${t.rating>0?`<div class="comment-author-rating-v3 stars-display-v3">${R}</div>`:""}
                </div>
            </div>
            <p class="comment-text-v3">${t.text.replace(/\n/g,"<br>")}</p>
            <div class="comment-meta-v3">
                <span class="comment-date-v3">${t.date}</span>
                <div class="comment-actions-group">
                    ${T}
                    ${u<2?`<button class="comment-action-btn-v3 btn-show-reply-form reply-btn-v3" data-parent-id="${t.id}"><i class="fas fa-reply"></i> <span>رد</span></button>`:""}
                </div>
            </div>
            <div class="comment-replies-container-v3" style="display: none;"></div>
            <div class="reply-form-container-v3" style="display:none;"></div>`;const $=i.querySelector(".btn-view-replies");$&&$.addEventListener("click",function(){const G=parseInt(this.dataset.commentId),Q=i.querySelector(".comment-replies-container-v3");V(Q,G,this)});const j=i.querySelector(".btn-show-reply-form");return j&&j.addEventListener("click",function(){const G=this.dataset.parentId,Q=i.querySelector(".reply-form-container-v3");F(Q,G)}),i}function I(t,u){for(let i of t){if(i.id===u)return i;if(i.replies&&i.replies.length>0){const m=I(i.replies,u);if(m)return m}}return null}async function V(t,u,i){if(!t||!i)return;const m=I(D,u);if(!m||!m.replies||m.replies.length===0)return;const g=t.style.display==="block",R=comment.replies.length===1?e("replay_1"):comment.replies.length===2?e("replay_2"):`${comment.replies.length} `+e("replaies");if(g)t.style.display="none",t.innerHTML="",p(i,!1,`<i class="fas fa-comments"></i> ${R}`),i.classList.remove("replies-shown");else{p(i,!0),await new Promise(j=>setTimeout(j,500)),t.innerHTML="";let O=0;const T=i.closest(".comment-item-v3"),$=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft";T&&T.style[$]&&(O=parseInt(T.style[$])/25||0),m.replies.forEach(j=>{t.appendChild(_(j,O+1))}),t.style.display="block",p(i,!1,'<i class="fas fa-comment-slash"></i> '+e("hide_replies")),i.classList.add("replies-shown")}}function F(t,u){if(W&&W!==t&&(W.style.display="none",W.innerHTML=""),t.style.display==="none"||W!==t){t.innerHTML=`
                <form class="add-reply-form-v3" data-parent-id="${u}">
                    <textarea name="replyText" rows="2" placeholder="${e("please_write_commit")}" required class="input-v3"></textarea>
                    <div class="reply-form-actions">
                        <button type="submit" class="btn-v3 btn-v3-primary btn-sm-v3">
                            <span class="btn-text">`+e("submit_reply")+`</span>
                        </button>
                        <button type="button" class="btn-v3 btn-v3-link btn-sm-v3 btn-cancel-reply">`+e("cancel")+`</button>
                    </div>
                </form>`,t.style.display="block",t.querySelector("textarea").focus(),W=t;const i=t.querySelector(".add-reply-form-v3");i.addEventListener("submit",U),i.querySelector(".btn-cancel-reply").addEventListener("click",()=>{t.style.display="none",t.innerHTML="",W=null})}else t.style.display="none",t.innerHTML="",W=null}async function U(t){t.preventDefault();const u=t.target,i=u.querySelector('button[type="submit"]'),m=parseInt(u.dataset.parentId),g=u.querySelector('textarea[name="replyText"]').value;if(g.trim()===""){alert(e("please_write_reply"));return}p(i,!0),await new Promise(O=>setTimeout(O,700));const R={id:Date.now(),author:e("you_visitor"),avatar:"https://placehold.co/32x32/999999/FFFFFF?text=U",rating:0,text:g,date:"الآن",parentId:m,replies:[]};P(R,m),K(R,m),S&&(S.textContent=X(D)),p(i,!1),u.parentElement&&(u.parentElement.style.display="none",u.parentElement.innerHTML=""),W=null}function P(t,u){function i(m){for(let g of m){if(g.id===u)return g.replies||(g.replies=[]),g.replies.unshift(t),!0;if(g.replies&&g.replies.length>0&&i(g.replies))return!0}return!1}i(D)}function K(t,u){const i=v.querySelector(`.comment-item-v3[data-comment-id="${u}"]`);if(i){const m=i.querySelector(".comment-replies-container-v3");let g=0;const R=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft",O=i.style[R]||"0px";if(g=parseInt(O)/25||0,m.prepend(_(t,g+1)),m.style.display==="none"){m.style.display="block";const T=i.querySelector(".btn-view-replies");if(T){const $=I(D,u);T.innerHTML='<i class="fas fa-comment-slash"></i> '+e("hide_replies"),T.classList.add("replies-shown"),$&&$.replies&&$.replies.length>0&&($.replies.length===1?e("replay_1"):$.replies.length===2?e("replay_2"):`${$.replies.length} `+e("replaies"))}}else{const T=i.querySelector(".btn-view-replies");if(T){const $=I(D,u);if($&&$.replies&&$.replies.length>0){const j=$.replies.length===1?e("replay_1"):$.replies.length===2?e("replay_2"):`${$.replies.length} `+e("replaies");T.classList.contains("replies-shown")?T.innerHTML='<i class="fas fa-comment-slash"></i> '+e("hide_replies"):T.innerHTML=`<i class="fas fa-comments"></i> ${j}`}}}}}function X(t){let u=0;function i(m){m.forEach(g=>{u++,g.replies&&g.replies.length>0&&i(g.replies)})}return i(t),u}async function N(){if(!v)return;const t=M===0&&(v.children.length===0||v.children.length===1&&v.children[0].id===o);t?document.getElementById(o)||(v.innerHTML=`<p style="text-align:center; padding:10px;" id="${o}"> ${e("loading_more_comments")} ${n}</p>`):w&&p(w,!0),await new Promise(R=>setTimeout(R,800));const u=document.getElementById(o);u&&u.remove(),w&&!t&&p(w,!1,'<span class="btn-text">'+e("load_more")+"</span>");const i=document.createDocumentFragment(),m=D.filter(R=>R.parentId===null),g=m.slice(M,M+r);g.length===0&&M===0?(v.innerHTML.trim()===""&&(v.innerHTML='<p class="no-more-comments-v3" style="display:block; text-align:center;">'+e("no_comments_yet")+"</p>"),w&&(w.style.display="none"),x&&(x.style.display="none")):(g.forEach(R=>i.appendChild(_(R,0))),v.appendChild(i)),M+=g.length,M>=m.length?(w&&(w.style.display="none"),x&&m.length>0?x.style.display="block":x&&(x.style.display="none")):(w&&m.length>0&&(w.style.display="block"),x&&(x.style.display="none")),S&&(S.textContent=X(D))}w&&w.addEventListener("click",N);const z=document.querySelectorAll(".btn-add-review-v3"),Z=l?l.querySelector(".btn-cancel-comment-review-v3"):null;z.forEach(t=>{t.addEventListener("click",()=>{if(l){l.classList.add("active"),l.scrollIntoView({behavior:"smooth",block:"center"});const u=l.querySelector('textarea[name="commentText"]');u&&u.focus()}})}),Z&&l&&Z.addEventListener("click",()=>{l.classList.remove("active"),l.reset();const t=document.getElementById("formStarRatingV3");t&&h(t);const u=document.getElementById("userRatingInputV3");u&&(u.value="0")}),l&&l.addEventListener("submit",async function(t){t.preventDefault();const u=this.querySelector('button[type="submit"]'),i=document.getElementById("userRatingInputV3"),m=document.getElementById("commentTextV3"),g=document.getElementById("commenterNameV3"),R=i?i.value:"0",O=m?m.value:"",T=g&&g.value?g.value:e("visitor");if(O.trim()===""){alert(e("please_write_commit"));return}p(u,!0),await new Promise(G=>setTimeout(G,900));const $={id:Date.now(),author:T,avatar:`https://placehold.co/36x36/ccc/000?text=${T.substring(0,1).toUpperCase()||"Z"}`,rating:parseInt(R)||0,text:O,date:"الآن",parentId:null,replies:[]};if(D.unshift($),v.querySelector('p.no-more-comments-v3[style*="display:block"]')||document.getElementById(o))v.innerHTML="",M=0,N();else{v.prepend(_($,0)),M++;const G=D.filter(Q=>Q.parentId===null);M<G.length&&w&&(w.style.display="block"),x&&(x.style.display="none")}S&&(S.textContent=X(D)),B(),p(u,!1),alert(e("thank_you_for_your_submission")),this.reset();const j=document.getElementById("formStarRatingV3");j&&h(j),i&&(i.value="0"),this.classList.remove("active")}),B(),N()}const Ce=function(){let n;function o(){if(!document.getElementById("leafletMapContainerV3"))return;const c=window.AppConfig.pageData.latitude,s=window.AppConfig.pageData.longitude;if(c===null||s===null){console.warn("Property latitude or longitude is not set.");return}n=L.map("leafletMapContainerV3").setView([c,s],17),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(n),L.marker([c,s]).addTo(n)}return{init:o}}();function _e(){const n=document.querySelector(".mobile-menu-toggle-v3"),o=document.querySelector(".site-header-v3");n&&o&&n.addEventListener("click",()=>{o.classList.toggle("mobile-menu-open-v3")})}ce();re();de();ue();pe();me();fe();ge();ye();he();ve();be();Le();we();Ce.init();_e();
