import{t as e,a as ee,s as A,g as J,c as oe,d as Y}from"./helpers-DwlY0Bzp.js";import{h as se}from"./api-2skSE4Ue.js";import{i as ie,c as ae}from"./phoneInput-C4-BQoBS.js";import"./index-xsH4HHeE.js";function re(){console.log("[FavoriteAction] initFavoriteAction() CALLED");const n=document.querySelector(".favorite-btn-v3");if(!n){console.log("[FavoriteAction] No .favorite-btn-v3 found.");return}const o=n.dataset.propertyId,d=n.querySelector("i");d&&(n.classList.contains("active")?(d.classList.remove("far","fa-regular"),d.classList.add("fas","fa-solid"),n.dataset.tooltip=e("favorite_remove_tooltip")):(d.classList.remove("fas","fa-solid"),d.classList.add("far","fa-regular"),n.dataset.tooltip=e("favorite_add_tooltip"))),n.addEventListener("click",async()=>{if(console.log("[FavoriteAction] FavBtn clicked, PropID:",o),!window.AppConfig.isAuthenticated){ee();return}if(!o){A("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!window.AppConfig.csrfToken){A("error",{bodyHtml:e("csrf_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!J("properties.toggle-favorite")){A("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const r=J("properties.toggle-favorite").replace("{propertyId}",o),s=n.querySelector(".spinner-border"),a=n.querySelector(".btn-text"),m=a?a.textContent:"";n.disabled=!0,s&&s.classList.remove("d-none"),a&&e("loading_text")&&(a.textContent=e("loading_text"));try{const g=(await se({onStatusCodeError:{401:h=>{var y,v,k;const l=(v=(y=h==null?void 0:h.response)==null?void 0:y.data)==null?void 0:v.message;(k=A)==null||k("error",{bodyHtml:l||e("auth_required_message"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),n.disabled=!1,s&&s.classList.add("d-none"),a&&(a.textContent=m)}}}).post(r,{})).data;if(g.success===!0&&g.data){const h=g.data.is_active;n.classList.toggle("active",h),d&&(h?(d.classList.remove("far","fa-regular"),d.classList.add("fas","fa-solid"),n.dataset.tooltip=e("favorite_remove_tooltip")):(d.classList.remove("fas","fa-solid"),d.classList.add("far","fa-regular"),n.dataset.tooltip=e("favorite_add_tooltip"))),g.message&&A("success",{bodyHtml:g.message,timerSeconds:1,showCloseIcon:!0})}else A("error",{bodyHtml:g.message||e("favorite_action_failed"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(_){console.error("[FavoriteAction] Favorite API error:",_),A("error",{bodyHtml:e("network_error"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{n.disabled=!1,s&&s.classList.add("d-none"),a&&(a.textContent=m)}})}const le=document.querySelectorAll(".modal-v3");function ne(n){n&&(n.style.display="flex",document.body.style.overflow="hidden")}function te(n){n&&(n.style.display="none",document.body.style.overflow="")}function ce(){le.forEach(n=>{n.addEventListener("click",o=>{o.target===n&&te(n)})})}function de(){console.log("[BlacklistAction] initBlacklistAction() CALLED");const n=document.getElementById("blacklistConfirmModal"),o=document.querySelector(".blacklist-btn-trigger-v3");if(!o){console.log("[BlacklistAction] No .blacklist-btn-trigger-v3 found.");return}if(!n){console.warn("[BlacklistAction] .blacklist-btn-trigger-v3 found, but #blacklistConfirmModal not found.");return}const d=n.querySelector("[data-close-blacklist-modal]"),r=document.getElementById("confirmBlacklistBtn"),s=document.getElementById("cancelBlacklistBtn"),a=document.getElementById("blacklistConfirmMessage");let m=o.classList.contains("active");const _=o.dataset.propertyId;_||console.warn("[BlacklistAction] Blacklist button .blacklist-btn-trigger-v3 is missing data-property-id.");function g(){if(!o)return;const y=o.querySelector("i");o.classList.toggle("active",m),y&&y.classList.toggle("active-blacklist",m),o.dataset.tooltip=m?e("blacklist_remove_tooltip"):e("blacklist_add_tooltip")}function h(){if(!a||!r){console.error("[BlacklistAction] Blacklist modal essential elements (message/confirm button) missing."),A("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}a.textContent=m?e("blacklist_remove_confirm_message"):e("blacklist_add_confirm_message"),r.textContent=m?e("blacklist_confirm_remove_button"):e("blacklist_confirm_add_button");const y=n.querySelector(".modal-title");y&&(y.textContent=m?e("blacklist_remove_confirm_title"):e("blacklist_add_confirm_title")),ne(n),n.style.display="flex"}function l(){if(n.style.display="none",r){r.disabled=!1;const y=r.querySelector(".spinner-border");y&&y.classList.add("d-none")}te(n)}g(),o.addEventListener("click",()=>{if(console.log("[BlacklistAction] BlacklistBtn clicked, PropID:",_),!window.AppConfig.isAuthenticated){ee();return}if(!_){A("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}h()}),d&&d.addEventListener("click",l),s&&s.addEventListener("click",l),n.addEventListener("click",y=>{y.target===n&&l()}),document.addEventListener("keydown",y=>{y.key==="Escape"&&n.style.display==="flex"&&l()}),r?r.addEventListener("click",async()=>{if(!window.AppConfig.isAuthenticated){ee(),l();return}if(!_){A("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),l();return}if(!window.AppConfig.csrfToken){A("error",{bodyHtml:e("csrf_error"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),l();return}if(!J("properties.toggle-blacklist")){A("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),l();return}const y=J("properties.toggle-blacklist").replace("{propertyId}",_),v=r.querySelector(".spinner-border");r.disabled=!0,v&&v.classList.remove("d-none");try{const q=(await se({onStatusCodeError:{401:w=>{var S,b,I;const B=(b=(S=w==null?void 0:w.response)==null?void 0:S.data)==null?void 0:b.message;(I=A)==null||I("error",{bodyHtml:B||e("auth_required_message"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),l()}}}).post(y,{})).data;q.success===!0&&q.data?(m=q.data.is_active,g(),A("success",{bodyHtml:q.message,timerSeconds:1,showCloseIcon:!0})):A("error",{bodyHtml:q.message||e("blacklist_action_failed"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(k){console.error("[BlacklistAction] Blacklist API error:",k),A("error",{bodyHtml:e("network_error"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{l()}}):console.error("[BlacklistAction] Critical: #confirmBlacklistBtn not found inside #blacklistConfirmModal.")}function ue(){console.log("[ReportAction] initReportAction() CALLED");const n=document.getElementById("reportPropertyModal"),o=document.getElementById("reportFormV3"),d=document.querySelectorAll(".report-btn-trigger-v3");if(d.length===0){console.log("[ReportAction] No .report-btn-trigger-v3 buttons found."),n&&console.warn("[ReportAction] #reportPropertyModal exists, but no .report-btn-trigger-v3 found.");return}if(!n){console.warn("[ReportAction] .report-btn-trigger-v3 found, but #reportPropertyModal is missing.");return}o||console.warn("[ReportAction] #reportPropertyModal found, but #reportFormV3 is missing.");const r=n.querySelector("[data-close-report-modal]");let s=null;const a=document.getElementById("reportUserName"),m=document.getElementById("reportUserEmail"),_=document.getElementById("reportUserMobile"),g=document.getElementById("closeReportBtn"),h=n.querySelectorAll(".user-details-group"),l=window.AppConfig.user,y=(l==null?void 0:l.mobile)||"",v=ie(_,y),k=ae(v,_,o.querySelector('.invalid-feedback[data-field="mobile"]'),e);k.setupEventListeners();function q(B){s=B,o&&(o.reset(),oe(o,["reason","details","name","email","mobile"]),window.AppConfig.isAuthenticated?h.forEach(S=>S.style.display="none"):o.classList.contains("allow-guest-submission")?(h.forEach(S=>S.style.display="block"),a&&(a.readOnly=!1),m&&(m.readOnly=!1),_&&(_.readOnly=!1)):h.forEach(S=>S.style.display="none")),ne(n),n.style.display="flex"}function w(){if(n.style.display="none",s=null,o){const B=o.querySelector('button[type="submit"]');B&&(B.disabled=!1,B.textContent=e("report_submit_button_text")||"Submit Report")}te(n)}d.forEach(B=>{B.addEventListener("click",function(){const S=this.dataset.propertyId;console.log("[ReportAction] OpenReportBtn clicked, data-property-id:",S);const b=this.classList.contains("allow-guest-report")||o&&o.classList.contains("allow-guest-submission");if(!window.AppConfig.isAuthenticated&&!b){ee();return}if(S)q(S);else{const I=J("properties.submit-report");let x=null;if(I&&typeof I=="string"&&!I.includes("{propertyId}")){const D=I.match(/\/properties\/(\d+)\/submit-report/);D&&D[1]&&(x=D[1])}x?(console.warn("[ReportAction] Report button missing data-property-id, inferred from global API URL:",x),q(x)):(console.error("[ReportAction] Report button missing data-property-id and could not infer. Cannot open report dialog."),A("error",{title:e("error_title"),bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}))}})}),r&&r.addEventListener("click",w),n.addEventListener("click",B=>{B.target===n&&w()}),g.addEventListener("click",B=>{w()}),document.addEventListener("keydown",B=>{B.key==="Escape"&&n.style.display==="flex"&&w()}),o&&o.addEventListener("submit",async B=>{var U,$;if(B.preventDefault(),console.log("[ReportAction] Report form submitted for propertyId:",s),!s){A("error",{title:e("error_title"),bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const S=o.classList.contains("allow-guest-submission");if(!window.AppConfig.isAuthenticated&&!S){ee();return}if(!window.AppConfig.csrfToken){A("error",{title:e("error_title"),bodyHtml:e("csrf_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!J("properties.submit-report")){A("error",{title:e("error_title"),bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const b=o.querySelector('button[type="submit"]'),I=b?b.textContent:e("report_submit_button_text");b&&(b.disabled=!0,b.textContent=e("submitting")),oe(o,["reason","details","name","email","mobile"]);const x=new FormData(o),D={reason:x.get("reportReason")||"",details:x.get("reportDetails")||""};if(!window.AppConfig.isAuthenticated&&S){D.name=(a==null?void 0:a.value)||"",D.email=(m==null?void 0:m.value)||"";const M=x.get("mobile");let u=M;if(k&&M&&M.trim()!==""&&!k.validate()){Y(o,{mobile:[e("phone_invalid")]},!0),A("error",{bodyHtml:e("phone_invalid"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),b&&(b.disabled=!1,b.textContent=I);return}(U=k.getInstance())!=null&&U.isValidNumber()?u=(($=k.getInstance())==null?void 0:$.getNumber())||M:(!M||M.trim()==="")&&(u=""),D.mobile=u}try{const M=await fetch(J("properties.submit-report"),{method:"POST",headers:{"X-CSRF-TOKEN":window.AppConfig.csrfToken,Accept:"application/json","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json"},body:JSON.stringify(D)}),u=await M.json();M.ok&&u.success===!0?(w(),A("success",{bodyHtml:u.message||e("report_submit_success"),timerSeconds:1,showCloseIcon:!0})):M.status===422&&u.errors?(Y(o,u.errors,!1),A("error",{bodyHtml:u.message||e("validation_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})):M.status===401?A("error",{bodyHtml:u.message||e("auth_required_message"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}):A("error",{bodyHtml:u.message||e("report_submit_failed"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(M){console.error("[ReportAction] Report API submission error:",M),A("error",{bodyHtml:e("network_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{b&&(b.disabled=!1,b.textContent=I)}})}function pe(){var l;const n=window.AppConfig.user,o=(n==null?void 0:n.name)||"",d=(n==null?void 0:n.email)||"",r=(n==null?void 0:n.mobile)||"",s=document.getElementById("contactAgentFormV3"),a=document.getElementById("agentContactPhoneV3"),m=window.AppConfig.pageData.owner.mobile,_=ie(a,r),g=ae(_,a,s.querySelector('.invalid-feedback[data-field="mobile"]'),e);if(g.setupEventListeners(),!window.AppConfig.isAuthenticated){const y=s.querySelector('input[name="name"]'),v=s.querySelector('input[name="email"]');y&&!y.value&&o&&(y.value=o),v&&!v.value&&d&&(v.value=d)}s.addEventListener("submit",async y=>{var b,I,x,D,U,$;if(y.preventDefault(),!window.AppConfig.csrfToken){A("error",{bodyHtml:e("csrf_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!J("properties.submit-report")){A("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const v=s.querySelector('button[type="submit"]'),k=v?v.textContent:e("contact_agent_send_button_text");v&&(v.disabled=!0,v.textContent=e("loading_text")),oe(s,["name","email","mobile","message"]);const q=new FormData(s),w=q.get("mobile");let B=w;if(g){if(w&&w.trim()!==""&&!g.validate()){Y(s,{mobile:[e("phone_invalid")]},!0),A("error",{bodyHtml:e("phone_invalid"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),v&&(v.disabled=!1,v.textContent=k);return}(b=g.getInstance())!=null&&b.isValidNumber()?B=((I=g.getInstance())==null?void 0:I.getNumber())||w:(!w||w.trim()==="")&&(B="")}const S={name:q.get("name"),email:q.get("email"),mobile:w,userPhoneFull:B,message:q.get("message")};try{const u=(await se({onStatusCodeError:{401:C=>{var T,F,P;const E=(F=(T=C==null?void 0:C.response)==null?void 0:T.data)==null?void 0:F.message;(P=A)==null||P("error",{bodyHtml:E||e("auth_required_message"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),v&&(v.disabled=!1,v.textContent=k)},422:C=>{var K,X,O,z,Z;const E=(X=(K=C==null?void 0:C.response)==null?void 0:K.data)==null?void 0:X.message,T=(z=(O=C==null?void 0:C.response)==null?void 0:O.data)==null?void 0:z.errors;let F=e("error_title"),P="",N="";if(T&&Object.keys(T).length>0){Y?Y(s,T):console.warn("[ContactAgentAction] displayActionFormErrors helper not available to show inline errors."),F=e("validation_error_title"),N=`<ul style="text-align: ${window.AppConfig.isRTL?"right":"left"}; list-style-position: inside; padding-${window.AppConfig.isRTL?"right":"left"}: 0; margin:0;">`;for(const t in T)T[t].forEach(c=>N+=`<li style="margin-bottom: 5px;">${c}</li>`);N+="</ul>",P=e("validation_error_summary")+"<br>"+N}else E?P=E:P=e("generic_error_try_again");v&&(v.disabled=!1,v.textContent=k),(Z=A)==null||Z("error",{title:F,bodyHtml:P,buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}}}).post(J("properties.contact-agent"),S)).data;if(v&&(v.disabled=!1,v.textContent=k),(x=A)==null||x("success",{bodyHtml:u.message||e("contact_message_sent_success"),timerSeconds:1,showCloseIcon:!0}),s.reset(),!window.AppConfig.isAuthenticated){const C=s.querySelector('input[name="name"]'),E=s.querySelector('input[name="email"]');C&&o&&(C.value=o),E&&d&&(E.value=d),g&&!window.AppConfig.isAuthenticated&&r?(D=g.getInstance())==null||D.setNumber(r):a&&!window.AppConfig.isAuthenticated&&r?a.value=r:g&&((U=g.getInstance())==null||U.setNumber(""))}}catch(M){console.error("[ContactAgentAction] Contact Agent API error:",M),v&&(v.disabled=!1,v.textContent=k),($=A)==null||$("error",{bodyHtml:e("network_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{v&&(v.disabled=!1,v.textContent=k)}});const h=document.getElementById("whatsappLinkV3");if(h&&typeof h<"u"&&typeof m<"u"){let y=(l=s.querySelector('[name="message"]'))==null?void 0:l.value;y=encodeURIComponent(y);const v=m.replace(/\D/g,"");h.href=`https://wa.me/${v}?text=${y}`}}function me(){const n=document.getElementById("showMobileModal"),o=document.querySelector("[data-close-mobile-modal]"),d=document.getElementById("agentMobileNumberDisplay"),r=document.getElementById("callAgentLink"),s=document.getElementById("copyMobileNumberBtnV3");function a(h,l,y,v,k){!h||!l||(navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(l).then(()=>{h.classList.add("copied"),k&&k.classList.add("show"),h.disabled=!0,setTimeout(()=>{h.classList.remove("copied"),k&&k.classList.remove("show"),h.disabled=!1;const q=h.querySelector("i");q&&!h.classList.contains("copied")&&(q.className="far fa-copy")},2e3)}).catch(q=>{console.error("Clipboard copy failed: ",q),alert(e("copy_fail"))}):alert("Clipboard API not supported"))}function m(){const h=window.AppConfig.pageData.owner.mobile;if(n){if(d&&(d.textContent=e("agent_number"),setTimeout(()=>{typeof h<"u"&&h?(d.textContent=h,r&&(r.href=`tel:${h}`),s&&(s.style.display="flex"),r&&(r.style.display="inline-flex")):(d.textContent=e("number_not_found"),r&&(r.style.display="none"),s&&(s.style.display="none"))},200)),s){s.classList.remove("copied"),s.disabled=!1;const l=s.querySelector("i");l&&(l.className="far fa-copy");const y=s.querySelector(".copied-feedback-v3");y&&y.classList.remove("show")}ne(n)}}function _(){te(n)}function g(){const h=document.querySelector(".show-mobile-btn");h&&h.addEventListener("click",m),o&&o.addEventListener("click",_),s&&d&&s.addEventListener("click",()=>{const l=d.textContent.replace(/\s+/g,"");l&&l!==e("loading_text")&&l!==e("number_not_found")&&a(s,l,null,null,s.querySelector(".copied-feedback-v3"))})}g()}function fe(){console.log("[ShareAction] initShareAction() CALLED");const n=document.getElementById("sharePropertyModal"),o=document.querySelectorAll(".share-btn-trigger-v3"),d=document.querySelector("[data-close-share-modal]"),r=document.getElementById("propertyShareLink"),s=document.getElementById("copyShareLinkBtn"),a=s?s.querySelector(".copy-btn-text"):null,m=document.getElementById("shareViaWhatsApp"),_=document.getElementById("shareViaTwitter"),g=document.getElementById("shareViaFacebook"),h=document.getElementById("shareViaEmail"),l=document.getElementById("shareViaLinkedIn"),y=document.getElementById("shareViaTelegram");function v(w,B,S,b,I){!w||!B||(navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(B).then(()=>{w.classList.add("copied"),S&&(S.textContent=b),w.disabled=!0,setTimeout(()=>{w.classList.remove("copied"),S&&(S.textContent=w.id==="copyShareLinkBtn"?e("copy_link"):e("copy_number")),w.disabled=!1;const x=w.querySelector("i");x&&!w.classList.contains("copied")&&(x.className="far fa-copy")},2e3)}).catch(x=>{console.error("Clipboard copy failed: ",x),alert(w.id==="copyShareLinkBtn"?e("copy_fail"):e("copy_fail"))}):alert("Clipboard API not supported"))}function k(){if(console.log("openShareModal"),console.log("shareModal",n),!n)return;const w=window.location.href;let B=document.title;const S=document.querySelector(".property-intro-v3 .title-location-v3 h1");S&&(B=S.textContent.trim()),r&&(r.value=w);const b=encodeURIComponent(w),I=encodeURIComponent(B);if(m&&(m.href=`https://wa.me/?text=${I}%20-%20${b}`),_&&(_.href=`https://twitter.com/intent/tweet?url=${b}&text=${I}`),g&&(g.href=`https://www.facebook.com/sharer/sharer.php?u=${b}`),h&&(h.href=`mailto:?subject=${I}&body=Check%20out%20this%20property:%20${b}`),l&&(l.href=`https://www.linkedin.com/sharing/share-offsite/?url=${b}`),y&&(y.href=`https://t.me/share/url?url=${b}&text=${I}`),s){s.classList.remove("copied"),s.disabled=!1,a&&(a.textContent=e("copy_link"));const x=s.querySelector("i");x&&(x.className="far fa-copy")}ne(n)}function q(){te(n)}o.forEach(w=>{w.addEventListener("click",k),d&&d.addEventListener("click",q),s&&r&&a&&s.addEventListener("click",()=>{v(s,r.value,a,e("copy_success"))})})}function ge(){const n=document.getElementById("seeMoreBtnV3"),o=document.getElementById("descriptionContentV3");n&&o&&n.addEventListener("click",()=>{o.classList.toggle("expanded-v3"),n.textContent=o.classList.contains("expanded-v3")?e("show_less"):e("show_more")})}function ye(){const n=(window.AppConfig.pageData.amenities||[]).map(function(m){return{name:m,icon:""}}),o=window.AppConfig.pageData.nearby_places||[],d=(window.AppConfig.pageData.attributes||[]).map(function(m){return{key:m.name,value:m.value,icon:""}}),r=document.getElementById("propertyAttributesListV3");r&&typeof d<"u"&&typeof ATTRIBUTE_ICON_MAP_V3<"u"&&(r.innerHTML="",d.forEach(m=>{const _=document.createElement("li"),g=m.icon||ATTRIBUTE_ICON_MAP_V3[m.key]||ATTRIBUTE_ICON_MAP_V3.default;_.innerHTML=`<i class="fas ${g}"></i> <strong>${m.key||e("attribute_default_name")}:</strong> <span>${m.value||"-"}</span>`,r.appendChild(_)}));const s=document.getElementById("amenitiesListV3");s&&typeof n<"u"&&(s.innerHTML="",n.forEach(m=>{const _=document.createElement("li");_.innerHTML=`<i class="fas ${m.icon||"fa-check-square"}"></i> <span>${m.name||e("aminity_default_name")}</span>`,s.appendChild(_)}));const a=document.getElementById("nearestPlacesListV3");a&&typeof NEAREST_PLACES_DATA_V3<"u"&&typeof PLACE_ICON_MAP_V3<"u"&&(a.innerHTML="",o.forEach(m=>{const _=document.createElement("li"),g=m.icon||PLACE_ICON_MAP_V3[m.type]||PLACE_ICON_MAP_V3.default;_.innerHTML=`<i class="fas ${g}"></i> <span>${m.name||e("nearby_place_default_name")}</span> <span class="place-distance-v3">(${m.distance||""})</span>`,a.appendChild(_)}))}function he(){const n=document.getElementById("floatingContactBtnV3"),o=document.querySelector(".agent-contact-card-v3");function d(s){if(!s)return!1;const a=s.getBoundingClientRect(),m=a.top<window.innerHeight&&a.bottom>=0,_=a.left<window.innerWidth&&a.right>=0;return m&&_}function r(){if(!n)return;d(o)?n.classList.remove("visible"):n.classList.add("visible")}n&&(document.querySelector(".agent-contact-card-v3")?(window.addEventListener("scroll",r,{passive:!0}),window.addEventListener("resize",r),r()):console.warn("Agent contact card not found for floating button visibility logic. Button may not behave as expected."),n.addEventListener("click",()=>{const s=document.querySelector(".agent-contact-card-v3");s?s.scrollIntoView({behavior:"smooth",block:"center"}):alert(e("contact_us_action"))}))}function ve(){const n=document.querySelector(".hero-swiper-section-v3"),o=document.querySelector(".hero-swiper"),d=document.getElementById("heroSwiperWrapperV3"),r=document.getElementById("thumbnailContainerV3"),s=document.getElementById("swiperProgressV3");let a=null;const m=991,_=1399,g=2,h=4,l=(AppConfig.pageData.images||[]).map(function(u){return{src:u,thumb:u,caption:""}});if(!n||!o||!d||!r||!s){console.error("Gallery init failed: Essential HTML elements for hero gallery missing.");return}if(typeof l>"u"||!Array.isArray(l)){console.error("Gallery init failed: images is not defined or not an array."),d&&(d.innerHTML='<p style="text-align:center; padding: 20px;">'+e("no_images_to_display")+"</p>");return}if(l.length===0){d&&(d.innerHTML='<p style="text-align:center; padding: 20px;">'+e("no_images_to_display")+"</p>"),r&&(r.style.display="none"),s&&(s.style.display="none");return}const y=l.map(u=>({src:u.src,thumb:u.thumb,caption:u.caption||""}));function v(){a&&(a.destroy(!0,!0),a=null)}function k(u){u.classList.remove("loading"),u.classList.add("loaded")}function q(u){u.classList.remove("loading"),u.classList.add("error");const C=u.closest("a");C&&C.classList.add("img-error"),console.warn("Image failed to load:",u.src||u.dataset.srcLarge)}function w(u=0){typeof Fancybox<"u"&&y.length>0?Fancybox.show(y,{startIndex:u,Hash:!1,Toolbar:{display:{left:["infobar"],middle:[],right:["slideshow","thumbs","fullscreen","close"]}},Thumbs:{autoStart:!0,type:"classic"},Carousel:{infinite:l.length>1},on:{selectSlide:(C,E,T)=>{a&&o.classList.contains("slider-layout-active")&&T&&typeof T.index<"u"&&a.slideToLoop(T.index)}}}):console.error("Fancybox library not loaded or no gallery items for Fancybox.")}function B(u,C,E,T=!1,F=""){const P=document.createElement("a");P.href=u.src,P.dataset.caption=u.caption||`Image ${C+1}`;const N=document.createElement("img");return N.alt=u.caption||`Image ${C+1}`,N.loading="lazy",N.classList.add("loading"),!E&&C===0?N.src=u.src:(N.src=u.thumb,E&&(N.dataset.srcLarge=u.src)),N.addEventListener("load",function(){E&&this.dataset.srcLarge&&this.src!==this.dataset.srcLarge?this.src=this.dataset.srcLarge:k(this)}),N.addEventListener("error",function(){q(this)}),P.appendChild(N),P.addEventListener("click",K=>{K.preventDefault(),w(C)}),T&&(P.dataset.morePhotosText=F),P}function S(u){if(d.innerHTML="",r&&(r.innerHTML=""),l.length!==0)if(u)l.forEach((C,E)=>{const T=document.createElement("div");if(T.classList.add("swiper-slide"),T.appendChild(B(C,E,!0)),d.appendChild(T),r){const F=document.createElement("img");F.src=C.thumb,F.alt=`Thumbnail ${E+1}`,F.loading="lazy",F.classList.add("thumbnail-v3","loading"),F.dataset.index=E,F.addEventListener("load",function(){k(this)}),F.addEventListener("error",function(){q(this)}),F.onclick=()=>{a&&a.slideToLoop(E)},r.appendChild(F)}});else{const C=l[0],E=document.createElement("div");if(E.classList.add("swiper-slide","grid-main-image"),E.appendChild(B(C,0,!1)),d.appendChild(E),l.length>1){const T=document.createElement("div");T.classList.add("small-images-grid");const F=innerWidth>_,P=F?h:g,N=l.length-1,K=Math.min(N,P);let X=[];for(let O=0;O<K;O++){const z=O+1,Z=l[z],t=O===K-1,c=N>P,i=t&&c;let p="";if(i){const V=N-K;p=`+${e("more_photos_overlay",{count:V})}`}const f=document.createElement("div");f.classList.add("swiper-slide"),i&&f.classList.add("has-more-photos-overlay"),f.appendChild(B(Z,z,!1,i,p)),X.push(f)}if(F&&X.length>=3&&P===4){const O=document.createElement("div");O.classList.add("small-image-row");const z=document.createElement("div");z.classList.add("small-image-row"),X.forEach((Z,t)=>t<2?O.appendChild(Z):z.appendChild(Z)),O.hasChildNodes()&&T.appendChild(O),z.hasChildNodes()&&T.appendChild(z)}else X.forEach(O=>T.appendChild(O));T.hasChildNodes()&&d.appendChild(T)}}}function b(u){if(s&&u&&u.slides&&u.slides.length>0&&l.length>0){const C=u.realIndex!==void 0?u.realIndex+1:1;s.textContent=`${C} / ${l.length}`}else s&&(s.textContent="")}function I(){const u=innerWidth;v(),n.classList.add("layout-changing"),o.className="swiper hero-swiper",r&&(r.style.display="none"),s&&(s.style.display="none");const C=u<=m||l.length<=1;if(n.classList.toggle("grid-active-section",!C),n.classList.toggle("slider-active-section",C),C){if(o.classList.add("slider-layout-active"),r&&l.length>1&&(r.style.display="flex"),s&&l.length>0&&(s.style.display="block"),S(!0),typeof Swiper<"u"&&l.length>0){if(a=new Swiper(o,{loop:l.length>1,slidesPerView:1,spaceBetween:10,pagination:{el:".swiper-pagination-slider",clickable:!0,dynamicBullets:l.length>5},navigation:{nextEl:".swiper-button-next-slider",prevEl:".swiper-button-prev-slider"},on:{init:b,slideChange:function(E){if(r){r.querySelectorAll(".thumbnail-v3").forEach(F=>F.classList.remove("active"));const T=r.querySelector(`.thumbnail-v3[data-index="${E.realIndex}"]`);T&&T.classList.add("active")}b(E)}}}),r&&l.length>1){const E=r.querySelector('.thumbnail-v3[data-index="0"]');E&&E.classList.add("active")}a&&b(a)}}else o.classList.add("grid-layout-active"),S(!1),o.classList.toggle("large-grid",u>_),o.classList.toggle("medium-grid",u>m&&u<=_),d.querySelectorAll(".swiper-slide:not(.has-more-photos-overlay) > a").forEach(E=>{E.addEventListener("mouseenter",()=>{o.classList.contains("grid-layout-active")&&o.classList.add("grid-hover-active")}),E.addEventListener("mouseleave",()=>{o.classList.contains("grid-layout-active")&&o.classList.remove("grid-hover-active")})});setTimeout(()=>n.classList.remove("layout-changing"),100)}const x=document.getElementById("floatingContactBtnV3"),D=document.querySelector(".agent-contact-card-v3");function U(u){if(!u)return!1;const C=u.getBoundingClientRect();return C.top<innerHeight&&C.bottom>=0&&C.left<innerWidth&&C.right>=0}function $(){if(!x)return;U(D)?x.classList.remove("visible"):x.classList.add("visible")}x&&(D&&(addEventListener("scroll",$,{passive:!0}),addEventListener("resize",$)),setTimeout($,150),x.addEventListener("click",()=>{const u=document.querySelector(".agent-contact-card-v3");u?u.scrollIntoView({behavior:"smooth",block:"center"}):alert("Contact section not found.")})),I();let M;addEventListener("resize",()=>{clearTimeout(M),M=setTimeout(I,250)})}function be(){const n=document.getElementById("tabsWrapperV3"),o=document.getElementById("tabButtonsContainerV3"),d=document.getElementById("scrollTabsLeftBtn"),r=document.getElementById("scrollTabsRightBtn"),s=document.querySelectorAll(".tab-button-v3"),a=document.querySelectorAll(".tab-content-v3");if(!n||!o)return;s.length>0&&a.length>0&&s.forEach(g=>{g.addEventListener("click",()=>{const h=g.dataset.tab;s.forEach(l=>l.classList.remove("active")),g.classList.add("active"),a.forEach(l=>{l.classList.remove("active"),l.id===h+"ContentV3"&&l.classList.add("active")})})}),d&&r&&(d.addEventListener("click",()=>{const g=o.clientWidth*.75;o.scrollBy({left:-g,behavior:"smooth"})}),r.addEventListener("click",()=>{const g=o.clientWidth*.75;o.scrollBy({left:g,behavior:"smooth"})}));function m(){if(!n)return;const h=document.documentElement.getAttribute("dir")==="rtl"?-o.scrollLeft:o.scrollLeft,l=o.scrollWidth-o.clientWidth,y=10;h>y?n.classList.add("show-scroll-hint-start"):n.classList.remove("show-scroll-hint-start"),h<l-y?n.classList.add("show-scroll-hint-end"):n.classList.remove("show-scroll-hint-end")}function _(){requestAnimationFrame(()=>{o.scrollWidth>o.clientWidth+1?(n.classList.add("is-scrollable"),m()):n.classList.remove("is-scrollable","show-scroll-hint-start","show-scroll-hint-end")})}setTimeout(_,150),o.addEventListener("scroll",m,{passive:!0}),window.addEventListener("resize",_)}function Le(){const n=document.getElementById("videoPlaceholderV3");n&&window.AppConfig.pageData.video_url&&n.addEventListener("click",()=>{typeof Fancybox<"u"?Fancybox.show([{src:window.AppConfig.pageData.video_url+"?autoplay=1",type:"iframe",preload:!1,iframe:{attr:{allow:"autoplay; fullscreen",allowfullscreen:!0}}}]):(alert(__("video_not_available")),console.warn("Fancybox not loaded. Video cannot be opened in a modal."))})}function we(){const n='<span class="loading-spinner-container"><i class="fas fa-spinner loading-spinner-v3"></i></span>',o="initialCommentLoadingMessageV3";function d(t,c,i=null){t&&(c?(t.dataset.originalContent||(t.dataset.originalContent=t.innerHTML),t.innerHTML=n,t.classList.add("loading"),t.disabled=!0):(i!==null?t.innerHTML=i:t.dataset.originalContent&&(t.innerHTML=t.dataset.originalContent),(t.innerHTML===n||t.innerHTML==="")&&(t.classList.contains("load-more-comments-v3")||t.id==="loadMoreCommentsV3"?t.innerHTML='<span class="btn-text">'+e("load_more")+"</span>":t.type==="submit"&&(t.innerHTML='<span class="btn-text">'+e("send")+"</span>")),t.classList.remove("loading"),t.disabled=!1,delete t.dataset.originalContent))}const r=document.querySelectorAll(".community-tab-button-v3"),s=document.querySelectorAll(".community-tab-content-v3"),a=document.getElementById("addCommentFormV3");r.forEach(t=>{t.addEventListener("click",c=>{r.forEach(p=>p.classList.remove("active")),t.classList.add("active");const i=t.dataset.tab;s.forEach(p=>{p.classList.remove("active"),p.id===i&&p.classList.add("active")}),a&&!c.target.classList.contains("btn-add-review-v3")&&!a.contains(c.target)&&a.classList.contains("active")&&a.classList.remove("active")})});const m=document.querySelectorAll(".faq-item-v3");m.forEach(t=>{const c=t.querySelector(".faq-question-v3"),i=t.querySelector(".faq-answer-v3");c&&i&&c.addEventListener("click",()=>{const p=t.classList.contains("active");m.forEach(f=>{if(f!==t&&f.classList.contains("active")){f.classList.remove("active");const V=f.querySelector(".faq-answer-v3");V&&(V.style.maxHeight=null)}}),p?(t.classList.remove("active"),i.style.maxHeight=null):(t.classList.add("active"),i.style.maxHeight=i.scrollHeight+"px")})});function _(t,c){document.querySelectorAll(t).forEach(p=>{const f=p.id==="formStarRatingV3"?document.getElementById("userRatingInputV3"):p.nextElementSibling;if(!f){console.warn("Star rating hidden input not found for container:",p);return}const V=p.querySelectorAll("i");V.forEach(W=>{W.addEventListener("click",function(){const R=this.dataset.value;f.value=R,g(V,R)}),W.addEventListener("mouseover",function(){g(V,this.dataset.value,!0)}),W.addEventListener("mouseout",function(){g(V,f.value)})})})}function g(t,c,i=!1){t.forEach(p=>{const f=parseInt(p.dataset.value);p.classList.remove("fas","far","selected","hovered"),f<=parseInt(c)?(p.classList.add("fas"),i?p.classList.add("hovered"):p.classList.add("selected")):p.classList.add("far")})}function h(t){if(!t)return;t.querySelectorAll("i").forEach(i=>{i.classList.remove("fas","selected","hovered"),i.classList.add("far")})}document.getElementById("formStarRatingV3")&&document.getElementById("userRatingInputV3")&&_("#formStarRatingV3");const l=document.getElementById("averageRatingValueV3"),y=document.getElementById("averageStarsDisplayV3"),v=document.getElementById("averageRatingTotalReviewsV3"),k=document.getElementById("totalRatingCountV3"),q=document.getElementById("ratingBreakdownContainerV3");let w={average:0,totalReviews:0,breakdown:[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}]};function B(t){if(!t||t.length===0)return{average:0,totalReviews:0,breakdown:[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}]};let c=0,i=0;const p=[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}];function f(W){W.forEach(R=>{R.rating&&R.rating>0&&R.parentId===null&&(c+=R.rating,i++,R.rating>=1&&R.rating<=5&&p[5-R.rating].count++)})}return f(t),{average:i>0?c/i:0,totalReviews:i,breakdown:p}}function S(){if(w=B($),l&&(l.textContent=w.average.toFixed(1)),v&&(v.textContent=w.totalReviews),k&&(k.textContent=w.totalReviews),y){y.innerHTML="";let t=w.average;for(let c=1;c<=5;c++){const i=document.createElement("i");t>=.75?(i.className="fas fa-star",t--):t>=.25?(i.className="fas fa-star-half-alt",t=0):i.className="far fa-star",y.appendChild(i)}}q&&(q.innerHTML="",w.breakdown.forEach(t=>{const c=w.totalReviews>0?t.count/w.totalReviews*100:0,i=document.createElement("div");i.className="rating-bar-row-v3",i.innerHTML=`<span>${t.stars} ${t.stars===1?e("star_1"):t.stars===2?e("star_2"):e("stars")}</span><div class="rating-bar-v3"><div class="rating-bar-filled-v3" style="width: ${c.toFixed(1)}%;"></div></div><span>(${t.count})</span>`,q.appendChild(i)}))}const b=document.getElementById("commentListV3"),I=document.getElementById("loadMoreCommentsV3"),x=document.getElementById("noMoreCommentsMessageV3"),D=document.getElementById("totalCommentCountV3");let U=null,$=[{id:1,author:"أحمد محمد",avatar:"https://placehold.co/36x36/778899/FFFFFF?text=A",rating:5,text:`فيلا رائعة جداً!
الموقع ممتاز والتشطيبات فاخرة.
أنصح بها بشدة للعائلات الكبيرة.`,date:"منذ يومين",parentId:null,replies:[{id:101,author:"مجموعة الثقة (الوكيل)",avatar:"https://placehold.co/32x32/0062cc/FFFFFF?text=و",rating:0,text:"شكراً جزيلاً لتقييمك الرائع أستاذ أحمد! نسعد بخدمتك.",date:"منذ يوم",parentId:1,replies:[]}]},{id:2,author:"سارة علي",avatar:"https://placehold.co/36x36/AACCFF/000000?text=S",rating:4,text:"تجربة جيدة بشكل عام، بعض الملاحظات البسيطة على الصيانة ولكن السعر مناسب.",date:"منذ أسبوع",parentId:null,replies:[{id:201,author:"مجموعة الثقة (الوكيل)",avatar:"https://placehold.co/32x32/0062cc/FFFFFF?text=و",rating:0,text:"شكراً لملاحظاتك سارة، نعمل على تحسين خدمات الصيانة باستمرار.",date:"منذ 6 أيام",parentId:2,replies:[]}]},{id:3,author:"خالد عبدالله",avatar:"https://placehold.co/36x36/FFD700/000000?text=K",rating:5,text:"كل شيء كان مثالياً، من الحجز إلى المغادرة. خدمة العملاء ممتازة.",date:"منذ 3 أسابيع",parentId:null,replies:[]},{id:4,author:"نورة إبراهيم",avatar:"https://placehold.co/36x36/E6E6FA/000000?text=N",rating:3,text:"الموقع جيد ولكن الأثاث يحتاج إلى تحديث بسيط. السعر معقول.",date:"منذ شهر",parentId:null,replies:[{id:102,author:"أحمد محمد",avatar:"https://placehold.co/32x32/778899/FFFFFF?text=A",rating:0,text:"أتفق معكِ بشأن الأثاث، لكن الموقع يعوض ذلك.",date:"منذ 3 أسابيع",parentId:4,replies:[{id:103,author:"نورة إبراهيم",avatar:"https://placehold.co/30x30/E6E6FA/000000?text=N",rating:0,text:"صحيح، سأفكر في الأمر مرة أخرى.",date:"منذ أسبوعين",parentId:102,replies:[]}]}]},{id:5,author:"عمر ياسين",avatar:"https://placehold.co/36x36/228B22/FFFFFF?text=O",rating:4,text:"المكان نظيف وهادئ جداً، مثالي للاسترخاء. الواي فاي كان ضعيفاً بعض الشيء.",date:"منذ شهرين",parentId:null,replies:[]},{id:6,author:"فاطمة حسن",avatar:"https://placehold.co/36x36/FFC0CB/000000?text=F",rating:5,text:"أفضل إقامة قضيتها على الإطلاق! الموظفون ودودون والمرافق ممتازة.",date:"منذ 3 شهور",parentId:null,replies:[]}],M=0;const u=2;function C(t,c=0){const i=document.createElement("div");i.className="comment-item-v3",i.dataset.commentId=t.id;const p=c*25,f=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft";c>0&&(i.style[f]=`${p}px`);let V="";if(t.rating&&t.rating>0)for(let G=1;G<=5;G++)V+=`<i class="${G<=t.rating?"fas":"far"} fa-star"></i>`;const W=Math.max(24,36-c*4);let R="";if(t.replies&&t.replies.length>0&&c<2){const G=t.replies.length===1?e("replay_1"):t.replies.length===2?e("replay_2"):`${t.replies.length} `+e("replaies");R=`<button class="comment-action-btn-v3 btn-view-replies" data-comment-id="${t.id}"><i class="fas fa-comments"></i> ${G}</button>`}i.innerHTML=`
            <div class="comment-author-v3">
                <img src="${t.avatar}" alt="${t.author}" class="comment-avatar-v3" style="width:${W}px; height:${W}px;">
                <div>
                    <span class="comment-author-name-v3">${t.author}</span>
                    ${t.rating>0?`<div class="comment-author-rating-v3 stars-display-v3">${V}</div>`:""}
                </div>
            </div>
            <p class="comment-text-v3">${t.text.replace(/\n/g,"<br>")}</p>
            <div class="comment-meta-v3">
                <span class="comment-date-v3">${t.date}</span>
                <div class="comment-actions-group">
                    ${R}
                    ${c<2?`<button class="comment-action-btn-v3 btn-show-reply-form reply-btn-v3" data-parent-id="${t.id}"><i class="fas fa-reply"></i> <span>رد</span></button>`:""}
                </div>
            </div>
            <div class="comment-replies-container-v3" style="display: none;"></div>
            <div class="reply-form-container-v3" style="display:none;"></div>`;const H=i.querySelector(".btn-view-replies");H&&H.addEventListener("click",function(){const G=parseInt(this.dataset.commentId),Q=i.querySelector(".comment-replies-container-v3");T(Q,G,this)});const j=i.querySelector(".btn-show-reply-form");return j&&j.addEventListener("click",function(){const G=this.dataset.parentId,Q=i.querySelector(".reply-form-container-v3");F(Q,G)}),i}function E(t,c){for(let i of t){if(i.id===c)return i;if(i.replies&&i.replies.length>0){const p=E(i.replies,c);if(p)return p}}return null}async function T(t,c,i){if(!t||!i)return;const p=E($,c);if(!p||!p.replies||p.replies.length===0)return;const f=t.style.display==="block",V=comment.replies.length===1?e("replay_1"):comment.replies.length===2?e("replay_2"):`${comment.replies.length} `+e("replaies");if(f)t.style.display="none",t.innerHTML="",d(i,!1,`<i class="fas fa-comments"></i> ${V}`),i.classList.remove("replies-shown");else{d(i,!0),await new Promise(j=>setTimeout(j,500)),t.innerHTML="";let W=0;const R=i.closest(".comment-item-v3"),H=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft";R&&R.style[H]&&(W=parseInt(R.style[H])/25||0),p.replies.forEach(j=>{t.appendChild(C(j,W+1))}),t.style.display="block",d(i,!1,'<i class="fas fa-comment-slash"></i> '+e("hide_replies")),i.classList.add("replies-shown")}}function F(t,c){if(U&&U!==t&&(U.style.display="none",U.innerHTML=""),t.style.display==="none"||U!==t){t.innerHTML=`
                <form class="add-reply-form-v3" data-parent-id="${c}">
                    <textarea name="replyText" rows="2" placeholder="${e("please_write_commit")}" required class="input-v3"></textarea>
                    <div class="reply-form-actions">
                        <button type="submit" class="btn-v3 btn-v3-primary btn-sm-v3">
                            <span class="btn-text">`+e("submit_reply")+`</span>
                        </button>
                        <button type="button" class="btn-v3 btn-v3-link btn-sm-v3 btn-cancel-reply">`+e("cancel")+`</button>
                    </div>
                </form>`,t.style.display="block",t.querySelector("textarea").focus(),U=t;const i=t.querySelector(".add-reply-form-v3");i.addEventListener("submit",P),i.querySelector(".btn-cancel-reply").addEventListener("click",()=>{t.style.display="none",t.innerHTML="",U=null})}else t.style.display="none",t.innerHTML="",U=null}async function P(t){t.preventDefault();const c=t.target,i=c.querySelector('button[type="submit"]'),p=parseInt(c.dataset.parentId),f=c.querySelector('textarea[name="replyText"]').value;if(f.trim()===""){alert(e("please_write_reply"));return}d(i,!0),await new Promise(W=>setTimeout(W,700));const V={id:Date.now(),author:e("you_visitor"),avatar:"https://placehold.co/32x32/999999/FFFFFF?text=U",rating:0,text:f,date:"الآن",parentId:p,replies:[]};N(V,p),K(V,p),D&&(D.textContent=X($)),d(i,!1),c.parentElement&&(c.parentElement.style.display="none",c.parentElement.innerHTML=""),U=null}function N(t,c){function i(p){for(let f of p){if(f.id===c)return f.replies||(f.replies=[]),f.replies.unshift(t),!0;if(f.replies&&f.replies.length>0&&i(f.replies))return!0}return!1}i($)}function K(t,c){const i=b.querySelector(`.comment-item-v3[data-comment-id="${c}"]`);if(i){const p=i.querySelector(".comment-replies-container-v3");let f=0;const V=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft",W=i.style[V]||"0px";if(f=parseInt(W)/25||0,p.prepend(C(t,f+1)),p.style.display==="none"){p.style.display="block";const R=i.querySelector(".btn-view-replies");if(R){const H=E($,c);R.innerHTML='<i class="fas fa-comment-slash"></i> '+e("hide_replies"),R.classList.add("replies-shown"),H&&H.replies&&H.replies.length>0&&(H.replies.length===1?e("replay_1"):H.replies.length===2?e("replay_2"):`${H.replies.length} `+e("replaies"))}}else{const R=i.querySelector(".btn-view-replies");if(R){const H=E($,c);if(H&&H.replies&&H.replies.length>0){const j=H.replies.length===1?e("replay_1"):H.replies.length===2?e("replay_2"):`${H.replies.length} `+e("replaies");R.classList.contains("replies-shown")?R.innerHTML='<i class="fas fa-comment-slash"></i> '+e("hide_replies"):R.innerHTML=`<i class="fas fa-comments"></i> ${j}`}}}}}function X(t){let c=0;function i(p){p.forEach(f=>{c++,f.replies&&f.replies.length>0&&i(f.replies)})}return i(t),c}async function O(){if(!b)return;const t=M===0&&(b.children.length===0||b.children.length===1&&b.children[0].id===o);t?document.getElementById(o)||(b.innerHTML=`<p style="text-align:center; padding:10px;" id="${o}"> ${e("loading_more_comments")} ${n}</p>`):I&&d(I,!0),await new Promise(V=>setTimeout(V,800));const c=document.getElementById(o);c&&c.remove(),I&&!t&&d(I,!1,'<span class="btn-text">'+e("load_more")+"</span>");const i=document.createDocumentFragment(),p=$.filter(V=>V.parentId===null),f=p.slice(M,M+u);f.length===0&&M===0?(b.innerHTML.trim()===""&&(b.innerHTML='<p class="no-more-comments-v3" style="display:block; text-align:center;">'+e("no_comments_yet")+"</p>"),I&&(I.style.display="none"),x&&(x.style.display="none")):(f.forEach(V=>i.appendChild(C(V,0))),b.appendChild(i)),M+=f.length,M>=p.length?(I&&(I.style.display="none"),x&&p.length>0?x.style.display="block":x&&(x.style.display="none")):(I&&p.length>0&&(I.style.display="block"),x&&(x.style.display="none")),D&&(D.textContent=X($))}I&&I.addEventListener("click",O);const z=document.querySelectorAll(".btn-add-review-v3"),Z=a?a.querySelector(".btn-cancel-comment-review-v3"):null;z.forEach(t=>{t.addEventListener("click",()=>{if(a){a.classList.add("active"),a.scrollIntoView({behavior:"smooth",block:"center"});const c=a.querySelector('textarea[name="commentText"]');c&&c.focus()}})}),Z&&a&&Z.addEventListener("click",()=>{a.classList.remove("active"),a.reset();const t=document.getElementById("formStarRatingV3");t&&h(t);const c=document.getElementById("userRatingInputV3");c&&(c.value="0")}),a&&a.addEventListener("submit",async function(t){t.preventDefault();const c=this.querySelector('button[type="submit"]'),i=document.getElementById("userRatingInputV3"),p=document.getElementById("commentTextV3"),f=document.getElementById("commenterNameV3"),V=i?i.value:"0",W=p?p.value:"",R=f&&f.value?f.value:e("visitor");if(W.trim()===""){alert(e("please_write_commit"));return}d(c,!0),await new Promise(G=>setTimeout(G,900));const H={id:Date.now(),author:R,avatar:`https://placehold.co/36x36/ccc/000?text=${R.substring(0,1).toUpperCase()||"Z"}`,rating:parseInt(V)||0,text:W,date:"الآن",parentId:null,replies:[]};if($.unshift(H),b.querySelector('p.no-more-comments-v3[style*="display:block"]')||document.getElementById(o))b.innerHTML="",M=0,O();else{b.prepend(C(H,0)),M++;const G=$.filter(Q=>Q.parentId===null);M<G.length&&I&&(I.style.display="block"),x&&(x.style.display="none")}D&&(D.textContent=X($)),S(),d(c,!1),alert(e("thank_you_for_your_submission")),this.reset();const j=document.getElementById("formStarRatingV3");j&&h(j),i&&(i.value="0"),this.classList.remove("active")}),S(),O()}const Ce=function(){let n;function o(){if(!document.getElementById("leafletMapContainerV3"))return;const r=window.AppConfig.pageData.latitude,s=window.AppConfig.pageData.longitude;if(r===null||s===null){console.warn("Property latitude or longitude is not set.");return}n=L.map("leafletMapContainerV3").setView([r,s],17),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(n),L.marker([r,s]).addTo(n)}return{init:o}}();function _e(){const n=document.querySelector(".mobile-menu-toggle-v3"),o=document.querySelector(".site-header-v3");n&&o&&n.addEventListener("click",()=>{o.classList.toggle("mobile-menu-open-v3")})}ce();re();de();ue();pe();me();fe();ge();ye();he();ve();be();Le();we();Ce.init();_e();
