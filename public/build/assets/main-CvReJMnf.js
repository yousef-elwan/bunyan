import{t as e,a as ee,s as R,g as J,c as se,d as Y}from"./helpers-DwlY0Bzp.js";import{h as ne}from"./api-B7h7ZzFK.js";import{i as ie,c as ae}from"./phoneInput-lwV570lb.js";import"./index-xsH4HHeE.js";function re(){console.log("[FavoriteAction] initFavoriteAction() CALLED");const n=document.querySelector(".favorite-btn-v3");if(!n){console.log("[FavoriteAction] No .favorite-btn-v3 found.");return}const o=n.dataset.propertyId,d=n.querySelector("i");d&&(n.classList.contains("active")?(d.classList.remove("far","fa-regular"),d.classList.add("fas","fa-solid"),n.dataset.tooltip=e("favorite_remove_tooltip")):(d.classList.remove("fas","fa-solid"),d.classList.add("far","fa-regular"),n.dataset.tooltip=e("favorite_add_tooltip"))),n.addEventListener("click",async()=>{if(console.log("[FavoriteAction] FavBtn clicked, PropID:",o),!window.AppConfig.isAuthenticated){ee();return}if(!o){R("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}if(!J("properties.toggle-favorite")){R("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const r=J("properties.toggle-favorite").replace("{propertyId}",o),s=n.querySelector(".spinner-border"),a=n.querySelector(".btn-text"),p=a?a.textContent:"";n.disabled=!0,s&&s.classList.remove("d-none"),a&&e("loading_text")&&(a.textContent=e("loading_text"));try{const y=(await ne({onStatusCodeError:{401:b=>{var h,w,A;const l=(w=(h=b==null?void 0:b.response)==null?void 0:h.data)==null?void 0:w.message;(A=R)==null||A("error",{bodyHtml:l||e("auth_required_message"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),n.disabled=!1,s&&s.classList.add("d-none"),a&&(a.textContent=p)}}}).post(r,{})).data;if(y.success===!0&&y.data){const b=y.data.is_active;n.classList.toggle("active",b),d&&(b?(d.classList.remove("far","fa-regular"),d.classList.add("fas","fa-solid"),n.dataset.tooltip=e("favorite_remove_tooltip")):(d.classList.remove("fas","fa-solid"),d.classList.add("far","fa-regular"),n.dataset.tooltip=e("favorite_add_tooltip"))),y.message&&R("success",{bodyHtml:y.message,timerSeconds:1,showCloseIcon:!0})}else R("error",{bodyHtml:y.message||e("favorite_action_failed"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(I){console.error("[FavoriteAction] Favorite API error:",I),R("error",{bodyHtml:e("network_error"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{n.disabled=!1,s&&s.classList.add("d-none"),a&&(a.textContent=p)}})}const le=document.querySelectorAll(".modal-v3");function oe(n){n&&(n.style.display="flex",document.body.style.overflow="hidden")}function te(n){n&&(n.style.display="none",document.body.style.overflow="")}function ce(){le.forEach(n=>{n.addEventListener("click",o=>{o.target===n&&te(n)})})}function de(){console.log("[BlacklistAction] initBlacklistAction() CALLED");const n=document.getElementById("blacklistConfirmModal"),o=document.querySelector(".blacklist-btn-trigger-v3");if(!o){console.log("[BlacklistAction] No .blacklist-btn-trigger-v3 found.");return}if(!n){console.warn("[BlacklistAction] .blacklist-btn-trigger-v3 found, but #blacklistConfirmModal not found.");return}const d=n.querySelector("[data-close-blacklist-modal]"),r=document.getElementById("confirmBlacklistBtn"),s=document.getElementById("cancelBlacklistBtn"),a=document.getElementById("blacklistConfirmMessage");let p=o.classList.contains("active");const I=o.dataset.propertyId;I||console.warn("[BlacklistAction] Blacklist button .blacklist-btn-trigger-v3 is missing data-property-id.");function y(){if(!o)return;const h=o.querySelector("i");o.classList.toggle("active",p),h&&h.classList.toggle("active-blacklist",p),o.dataset.tooltip=p?e("blacklist_remove_tooltip"):e("blacklist_add_tooltip")}function b(){if(!a||!r){console.error("[BlacklistAction] Blacklist modal essential elements (message/confirm button) missing."),R("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}a.textContent=p?e("blacklist_remove_confirm_message"):e("blacklist_add_confirm_message"),r.textContent=p?e("blacklist_confirm_remove_button"):e("blacklist_confirm_add_button");const h=n.querySelector(".modal-title");h&&(h.textContent=p?e("blacklist_remove_confirm_title"):e("blacklist_add_confirm_title")),oe(n),n.style.display="flex"}function l(){if(n.style.display="none",r){r.disabled=!1;const h=r.querySelector(".spinner-border");h&&h.classList.add("d-none")}te(n)}y(),o.addEventListener("click",()=>{if(console.log("[BlacklistAction] BlacklistBtn clicked, PropID:",I),!window.AppConfig.isAuthenticated){ee();return}if(!I){R("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}b()}),d&&d.addEventListener("click",l),s&&s.addEventListener("click",l),n.addEventListener("click",h=>{h.target===n&&l()}),document.addEventListener("keydown",h=>{h.key==="Escape"&&n.style.display==="flex"&&l()}),r?r.addEventListener("click",async()=>{if(!window.AppConfig.isAuthenticated){ee(),l();return}if(!I){R("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),l();return}if(!J("properties.toggle-blacklist")){R("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),l();return}const h=J("properties.toggle-blacklist").replace("{propertyId}",I),w=r.querySelector(".spinner-border");r.disabled=!0,w&&w.classList.remove("d-none");try{const q=(await ne({onStatusCodeError:{401:C=>{var S,_,B;const E=(_=(S=C==null?void 0:C.response)==null?void 0:S.data)==null?void 0:_.message;(B=R)==null||B("error",{bodyHtml:E||e("auth_required_message"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),l()}}}).post(h,{})).data;q.success===!0&&q.data?(p=q.data.is_active,y(),R("success",{bodyHtml:q.message,timerSeconds:1,showCloseIcon:!0})):R("error",{bodyHtml:q.message||e("blacklist_action_failed"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(A){console.error("[BlacklistAction] Blacklist API error:",A),R("error",{bodyHtml:e("network_error"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{l()}}):console.error("[BlacklistAction] Critical: #confirmBlacklistBtn not found inside #blacklistConfirmModal.")}function ue(){console.log("[ReportAction] initReportAction() CALLED");const n=document.getElementById("reportPropertyModal"),o=document.getElementById("reportFormV3"),d=document.querySelectorAll(".report-btn-trigger-v3");if(d.length===0){console.log("[ReportAction] No .report-btn-trigger-v3 buttons found."),n&&console.warn("[ReportAction] #reportPropertyModal exists, but no .report-btn-trigger-v3 found.");return}if(!n){console.warn("[ReportAction] .report-btn-trigger-v3 found, but #reportPropertyModal is missing.");return}o||console.warn("[ReportAction] #reportPropertyModal found, but #reportFormV3 is missing.");const r=n.querySelector("[data-close-report-modal]");let s=null;const a=document.getElementById("reportUserName"),p=document.getElementById("reportUserEmail"),I=document.getElementById("reportUserMobile"),y=document.getElementById("closeReportBtn"),b=n.querySelectorAll(".user-details-group"),l=window.AppConfig.user,h=(l==null?void 0:l.mobile)||"",w=ie(I,h),A=ae(w,I,o.querySelector('.invalid-feedback[data-field="mobile"]'),e);A.setupEventListeners();function q(E){s=E,o&&(o.reset(),se(o,["type_id","message","name","email","mobile"]),window.AppConfig.isAuthenticated?b.forEach(S=>S.style.display="none"):o.classList.contains("allow-guest-submission")?(b.forEach(S=>S.style.display="block"),a&&(a.readOnly=!1),p&&(p.readOnly=!1),I&&(I.readOnly=!1)):b.forEach(S=>S.style.display="none")),oe(n),n.style.display="flex"}function C(){if(n.style.display="none",s=null,o){const E=o.querySelector('button[type="submit"]');E&&(E.disabled=!1,E.textContent=e("report_submit_button_text")||"Submit Report")}te(n)}d.forEach(E=>{E.addEventListener("click",function(){const S=this.dataset.propertyId;console.log("[ReportAction] OpenReportBtn clicked, data-property-id:",S);const _=this.classList.contains("allow-guest-report")||o&&o.classList.contains("allow-guest-submission");if(!window.AppConfig.isAuthenticated&&!_){ee();return}S&&q(S)})}),r&&r.addEventListener("click",C),n.addEventListener("click",E=>{E.target===n&&C()}),y.addEventListener("click",E=>{C()}),document.addEventListener("keydown",E=>{E.key==="Escape"&&n.style.display==="flex"&&C()}),o&&o.addEventListener("submit",async E=>{var U,P;if(E.preventDefault(),console.log("[ReportAction] Report form submitted for propertyId:",s),!s){R("error",{title:e("error_title"),bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const S=o.classList.contains("allow-guest-submission");if(!window.AppConfig.isAuthenticated&&!S){ee();return}if(!J("properties.submit-report")){R("error",{title:e("error_title"),bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const _=o.querySelector('button[type="submit"]'),B=_?_.textContent:e("report_submit_button_text");_&&(_.disabled=!0,_.textContent=e("submitting")),se(o,["type_id","message","name","email","mobile"]);const k=new FormData(o),W={type_id:k.get("reportReason")||"",message:k.get("reportDetails")||""};if(!window.AppConfig.isAuthenticated&&S){W.name=(a==null?void 0:a.value)||"",W.email=(p==null?void 0:p.value)||"";const F=k.get("mobile");let m=F;if(A&&F&&F.trim()!==""&&!A.validate()){Y(o,{mobile:[e("phone_invalid")]},!0),R("error",{bodyHtml:e("phone_invalid"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),_&&(_.disabled=!1,_.textContent=B);return}(U=A.getInstance())!=null&&U.isValidNumber()?m=((P=A.getInstance())==null?void 0:P.getNumber())||F:(!F||F.trim()==="")&&(m=""),W.mobile=m}try{const F=J("properties.submit-report").replace("{propertyId}",s),f=(await ne({onStatusCodeError:{401:v=>{var T,H,D;const x=(H=(T=v==null?void 0:v.response)==null?void 0:T.data)==null?void 0:H.message;(D=R)==null||D("error",{bodyHtml:x||e("auth_required_message"),buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),C()},422:v=>{var H,D,z,G;const x=(D=(H=v==null?void 0:v.response)==null?void 0:H.data)==null?void 0:D.message,T=(G=(z=v==null?void 0:v.response)==null?void 0:z.data)==null?void 0:G.errors;Y(o,T,!1),R("error",{bodyHtml:x,buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}}}).post(F,JSON.stringify(W))).data;f.success===!0&&f.data?(C(),R("success",{bodyHtml:f.message,timerSeconds:1,showCloseIcon:!0})):R("error",{bodyHtml:f.message,buttons:[{text:e("ok_button_text"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}catch(F){console.error("[ReportAction] Report API submission error:",F),R("error",{bodyHtml:e("network_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{C(),_&&(_.disabled=!1,_.textContent=B)}})}function pe(){var l;const n=window.AppConfig.user,o=(n==null?void 0:n.name)||"",d=(n==null?void 0:n.email)||"",r=(n==null?void 0:n.mobile)||"",s=document.getElementById("contactAgentFormV3"),a=document.getElementById("agentContactPhoneV3"),p=window.AppConfig.pageData.owner.mobile,I=ie(a,r),y=ae(I,a,s.querySelector('.invalid-feedback[data-field="mobile"]'),e);if(y.setupEventListeners(),!window.AppConfig.isAuthenticated){const h=s.querySelector('input[name="name"]'),w=s.querySelector('input[name="email"]');h&&!h.value&&o&&(h.value=o),w&&!w.value&&d&&(w.value=d)}s.addEventListener("submit",async h=>{var _,B,k,W,U,P;if(h.preventDefault(),!J("properties.submit-report")){R("error",{bodyHtml:e("generic_error_try_again"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0});return}const w=s.querySelector('button[type="submit"]'),A=w?w.textContent:e("contact_agent_send_button_text");w&&(w.disabled=!0,w.textContent=e("loading_text")),se(s,["name","email","mobile","message"]);const q=new FormData(s),C=q.get("mobile");let E=C;if(y){if(C&&C.trim()!==""&&!y.validate()){Y(s,{mobile:[e("phone_invalid")]},!0),R("error",{bodyHtml:e("phone_invalid"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),w&&(w.disabled=!1,w.textContent=A);return}(_=y.getInstance())!=null&&_.isValidNumber()?E=((B=y.getInstance())==null?void 0:B.getNumber())||C:(!C||C.trim()==="")&&(E="")}const S={name:q.get("name"),email:q.get("email"),mobile:C,userPhoneFull:E,message:q.get("message")};try{const m=(await ne({onStatusCodeError:{401:f=>{var x,T,H;const v=(T=(x=f==null?void 0:f.response)==null?void 0:x.data)==null?void 0:T.message;(H=R)==null||H("error",{bodyHtml:v||e("auth_required_message"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0}),w&&(w.disabled=!1,w.textContent=A)},422:f=>{var z,G,N,K,Z;const v=(G=(z=f==null?void 0:f.response)==null?void 0:z.data)==null?void 0:G.message,x=(K=(N=f==null?void 0:f.response)==null?void 0:N.data)==null?void 0:K.errors;let T=e("error_title"),H="",D="";if(x&&Object.keys(x).length>0){Y?Y(s,x):console.warn("[ContactAgentAction] displayActionFormErrors helper not available to show inline errors."),T=e("validation_error_title"),D=`<ul style="text-align: ${window.AppConfig.isRTL?"right":"left"}; list-style-position: inside; padding-${window.AppConfig.isRTL?"right":"left"}: 0; margin:0;">`;for(const t in x)x[t].forEach(c=>D+=`<li style="margin-bottom: 5px;">${c}</li>`);D+="</ul>",H=e("validation_error_summary")+"<br>"+D}else v?H=v:H=e("generic_error_try_again");w&&(w.disabled=!1,w.textContent=A),(Z=R)==null||Z("error",{title:T,bodyHtml:H,buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}}}).post(J("properties.contact-agent"),S)).data;if(w&&(w.disabled=!1,w.textContent=A),(k=R)==null||k("success",{bodyHtml:m.message||e("contact_message_sent_success"),timerSeconds:1,showCloseIcon:!0}),s.reset(),!window.AppConfig.isAuthenticated){const f=s.querySelector('input[name="name"]'),v=s.querySelector('input[name="email"]');f&&o&&(f.value=o),v&&d&&(v.value=d),y&&!window.AppConfig.isAuthenticated&&r?(W=y.getInstance())==null||W.setNumber(r):a&&!window.AppConfig.isAuthenticated&&r?a.value=r:y&&((U=y.getInstance())==null||U.setNumber(""))}}catch(F){console.error("[ContactAgentAction] Contact Agent API error:",F),w&&(w.disabled=!1,w.textContent=A),(P=R)==null||P("error",{bodyHtml:e("network_error"),buttons:[{text:e("close"),class:"my-modal-btn-primary"}],showCloseIcon:!0})}finally{w&&(w.disabled=!1,w.textContent=A)}});const b=document.getElementById("whatsappLinkV3");if(b&&typeof b<"u"&&typeof p<"u"){let h=(l=s.querySelector('[name="message"]'))==null?void 0:l.value;h=encodeURIComponent(h);const w=p.replace(/\D/g,"");b.href=`https://wa.me/${w}?text=${h}`}}function me(){const n=document.getElementById("showMobileModal"),o=document.querySelector("[data-close-mobile-modal]"),d=document.getElementById("agentMobileNumberDisplay"),r=document.getElementById("callAgentLink"),s=document.getElementById("copyMobileNumberBtnV3");function a(b,l,h,w,A){!b||!l||(navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(l).then(()=>{b.classList.add("copied"),A&&A.classList.add("show"),b.disabled=!0,setTimeout(()=>{b.classList.remove("copied"),A&&A.classList.remove("show"),b.disabled=!1;const q=b.querySelector("i");q&&!b.classList.contains("copied")&&(q.className="far fa-copy")},2e3)}).catch(q=>{console.error("Clipboard copy failed: ",q),alert(e("copy_fail"))}):alert("Clipboard API not supported"))}function p(){const b=window.AppConfig.pageData.owner.mobile;if(n){if(d&&(d.textContent=e("agent_number"),setTimeout(()=>{typeof b<"u"&&b?(d.textContent=b,r&&(r.href=`tel:${b}`),s&&(s.style.display="flex"),r&&(r.style.display="inline-flex")):(d.textContent=e("number_not_found"),r&&(r.style.display="none"),s&&(s.style.display="none"))},200)),s){s.classList.remove("copied"),s.disabled=!1;const l=s.querySelector("i");l&&(l.className="far fa-copy");const h=s.querySelector(".copied-feedback-v3");h&&h.classList.remove("show")}oe(n)}}function I(){te(n)}function y(){const b=document.querySelector(".show-mobile-btn");b&&b.addEventListener("click",p),o&&o.addEventListener("click",I),s&&d&&s.addEventListener("click",()=>{const l=d.textContent.replace(/\s+/g,"");l&&l!==e("loading_text")&&l!==e("number_not_found")&&a(s,l,null,null,s.querySelector(".copied-feedback-v3"))})}y()}function fe(){console.log("[ShareAction] initShareAction() CALLED");const n=document.getElementById("sharePropertyModal"),o=document.querySelectorAll(".share-btn-trigger-v3"),d=document.querySelector("[data-close-share-modal]"),r=document.getElementById("propertyShareLink"),s=document.getElementById("copyShareLinkBtn"),a=s?s.querySelector(".copy-btn-text"):null,p=document.getElementById("shareViaWhatsApp"),I=document.getElementById("shareViaTwitter"),y=document.getElementById("shareViaFacebook"),b=document.getElementById("shareViaEmail"),l=document.getElementById("shareViaLinkedIn"),h=document.getElementById("shareViaTelegram");function w(C,E,S,_,B){!C||!E||(navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(E).then(()=>{C.classList.add("copied"),S&&(S.textContent=_),C.disabled=!0,setTimeout(()=>{C.classList.remove("copied"),S&&(S.textContent=C.id==="copyShareLinkBtn"?e("copy_link"):e("copy_number")),C.disabled=!1;const k=C.querySelector("i");k&&!C.classList.contains("copied")&&(k.className="far fa-copy")},2e3)}).catch(k=>{console.error("Clipboard copy failed: ",k),alert(C.id==="copyShareLinkBtn"?e("copy_fail"):e("copy_fail"))}):alert("Clipboard API not supported"))}function A(){if(console.log("openShareModal"),console.log("shareModal",n),!n)return;const C=window.location.href;let E=document.title;const S=document.querySelector(".property-intro-v3 .title-location-v3 h1");S&&(E=S.textContent.trim()),r&&(r.value=C);const _=encodeURIComponent(C),B=encodeURIComponent(E);if(p&&(p.href=`https://wa.me/?text=${B}%20-%20${_}`),I&&(I.href=`https://twitter.com/intent/tweet?url=${_}&text=${B}`),y&&(y.href=`https://www.facebook.com/sharer/sharer.php?u=${_}`),b&&(b.href=`mailto:?subject=${B}&body=Check%20out%20this%20property:%20${_}`),l&&(l.href=`https://www.linkedin.com/sharing/share-offsite/?url=${_}`),h&&(h.href=`https://t.me/share/url?url=${_}&text=${B}`),s){s.classList.remove("copied"),s.disabled=!1,a&&(a.textContent=e("copy_link"));const k=s.querySelector("i");k&&(k.className="far fa-copy")}oe(n)}function q(){te(n)}o.forEach(C=>{C.addEventListener("click",A),d&&d.addEventListener("click",q),s&&r&&a&&s.addEventListener("click",()=>{w(s,r.value,a,e("copy_success"))})})}function ge(){const n=document.getElementById("seeMoreBtnV3"),o=document.getElementById("descriptionContentV3");n&&o&&n.addEventListener("click",()=>{o.classList.toggle("expanded-v3"),n.textContent=o.classList.contains("expanded-v3")?e("show_less"):e("show_more")})}function ye(){const n=(window.AppConfig.pageData.amenities||[]).map(function(p){return{name:p,icon:""}}),o=window.AppConfig.pageData.nearby_places||[],d=(window.AppConfig.pageData.attributes||[]).map(function(p){return{key:p.name,value:p.value,icon:""}}),r=document.getElementById("propertyAttributesListV3");r&&typeof d<"u"&&typeof ATTRIBUTE_ICON_MAP_V3<"u"&&(r.innerHTML="",d.forEach(p=>{const I=document.createElement("li"),y=p.icon||ATTRIBUTE_ICON_MAP_V3[p.key]||ATTRIBUTE_ICON_MAP_V3.default;I.innerHTML=`<i class="fas ${y}"></i> <strong>${p.key||e("attribute_default_name")}:</strong> <span>${p.value||"-"}</span>`,r.appendChild(I)}));const s=document.getElementById("amenitiesListV3");s&&typeof n<"u"&&(s.innerHTML="",n.forEach(p=>{const I=document.createElement("li");I.innerHTML=`<i class="fas ${p.icon||"fa-check-square"}"></i> <span>${p.name||e("aminity_default_name")}</span>`,s.appendChild(I)}));const a=document.getElementById("nearestPlacesListV3");a&&typeof NEAREST_PLACES_DATA_V3<"u"&&typeof PLACE_ICON_MAP_V3<"u"&&(a.innerHTML="",o.forEach(p=>{const I=document.createElement("li"),y=p.icon||PLACE_ICON_MAP_V3[p.type]||PLACE_ICON_MAP_V3.default;I.innerHTML=`<i class="fas ${y}"></i> <span>${p.name||e("nearby_place_default_name")}</span> <span class="place-distance-v3">(${p.distance||""})</span>`,a.appendChild(I)}))}function he(){const n=document.getElementById("floatingContactBtnV3"),o=document.querySelector(".agent-contact-card-v3");function d(s){if(!s)return!1;const a=s.getBoundingClientRect(),p=a.top<window.innerHeight&&a.bottom>=0,I=a.left<window.innerWidth&&a.right>=0;return p&&I}function r(){if(!n)return;d(o)?n.classList.remove("visible"):n.classList.add("visible")}n&&(document.querySelector(".agent-contact-card-v3")?(window.addEventListener("scroll",r,{passive:!0}),window.addEventListener("resize",r),r()):console.warn("Agent contact card not found for floating button visibility logic. Button may not behave as expected."),n.addEventListener("click",()=>{const s=document.querySelector(".agent-contact-card-v3");s?s.scrollIntoView({behavior:"smooth",block:"center"}):alert(e("contact_us_action"))}))}function ve(){const n=document.querySelector(".hero-swiper-section-v3"),o=document.querySelector(".hero-swiper"),d=document.getElementById("heroSwiperWrapperV3"),r=document.getElementById("thumbnailContainerV3"),s=document.getElementById("swiperProgressV3");let a=null;const p=991,I=1399,y=2,b=4,l=(AppConfig.pageData.images||[]).map(function(m){return{src:m,thumb:m,caption:""}});if(!n||!o||!d||!r||!s){console.error("Gallery init failed: Essential HTML elements for hero gallery missing.");return}if(typeof l>"u"||!Array.isArray(l)){console.error("Gallery init failed: images is not defined or not an array."),d&&(d.innerHTML='<p style="text-align:center; padding: 20px;">'+e("no_images_to_display")+"</p>");return}if(l.length===0){d&&(d.innerHTML='<p style="text-align:center; padding: 20px;">'+e("no_images_to_display")+"</p>"),r&&(r.style.display="none"),s&&(s.style.display="none");return}const h=l.map(m=>({src:m.src,thumb:m.thumb,caption:m.caption||""}));function w(){a&&(a.destroy(!0,!0),a=null)}function A(m){m.classList.remove("loading"),m.classList.add("loaded")}function q(m){m.classList.remove("loading"),m.classList.add("error");const f=m.closest("a");f&&f.classList.add("img-error"),console.warn("Image failed to load:",m.src||m.dataset.srcLarge)}function C(m=0){typeof Fancybox<"u"&&h.length>0?Fancybox.show(h,{startIndex:m,Hash:!1,Toolbar:{display:{left:["infobar"],middle:[],right:["slideshow","thumbs","fullscreen","close"]}},Thumbs:{autoStart:!0,type:"classic"},Carousel:{infinite:l.length>1},on:{selectSlide:(f,v,x)=>{a&&o.classList.contains("slider-layout-active")&&x&&typeof x.index<"u"&&a.slideToLoop(x.index)}}}):console.error("Fancybox library not loaded or no gallery items for Fancybox.")}function E(m,f,v,x=!1,T=""){const H=document.createElement("a");H.href=m.src,H.dataset.caption=m.caption||`Image ${f+1}`;const D=document.createElement("img");return D.alt=m.caption||`Image ${f+1}`,D.loading="lazy",D.classList.add("loading"),!v&&f===0?D.src=m.src:(D.src=m.thumb,v&&(D.dataset.srcLarge=m.src)),D.addEventListener("load",function(){v&&this.dataset.srcLarge&&this.src!==this.dataset.srcLarge?this.src=this.dataset.srcLarge:A(this)}),D.addEventListener("error",function(){q(this)}),H.appendChild(D),H.addEventListener("click",z=>{z.preventDefault(),C(f)}),x&&(H.dataset.morePhotosText=T),H}function S(m){if(d.innerHTML="",r&&(r.innerHTML=""),l.length!==0)if(m)l.forEach((f,v)=>{const x=document.createElement("div");if(x.classList.add("swiper-slide"),x.appendChild(E(f,v,!0)),d.appendChild(x),r){const T=document.createElement("img");T.src=f.thumb,T.alt=`Thumbnail ${v+1}`,T.loading="lazy",T.classList.add("thumbnail-v3","loading"),T.dataset.index=v,T.addEventListener("load",function(){A(this)}),T.addEventListener("error",function(){q(this)}),T.onclick=()=>{a&&a.slideToLoop(v)},r.appendChild(T)}});else{const f=l[0],v=document.createElement("div");if(v.classList.add("swiper-slide","grid-main-image"),v.appendChild(E(f,0,!1)),d.appendChild(v),l.length>1){const x=document.createElement("div");x.classList.add("small-images-grid");const T=innerWidth>I,H=T?b:y,D=l.length-1,z=Math.min(D,H);let G=[];for(let N=0;N<z;N++){const K=N+1,Z=l[K],t=N===z-1,c=D>H,i=t&&c;let u="";if(i){const V=D-z;u=`+${e("more_photos_overlay",{count:V})}`}const g=document.createElement("div");g.classList.add("swiper-slide"),i&&g.classList.add("has-more-photos-overlay"),g.appendChild(E(Z,K,!1,i,u)),G.push(g)}if(T&&G.length>=3&&H===4){const N=document.createElement("div");N.classList.add("small-image-row");const K=document.createElement("div");K.classList.add("small-image-row"),G.forEach((Z,t)=>t<2?N.appendChild(Z):K.appendChild(Z)),N.hasChildNodes()&&x.appendChild(N),K.hasChildNodes()&&x.appendChild(K)}else G.forEach(N=>x.appendChild(N));x.hasChildNodes()&&d.appendChild(x)}}}function _(m){if(s&&m&&m.slides&&m.slides.length>0&&l.length>0){const f=m.realIndex!==void 0?m.realIndex+1:1;s.textContent=`${f} / ${l.length}`}else s&&(s.textContent="")}function B(){const m=innerWidth;w(),n.classList.add("layout-changing"),o.className="swiper hero-swiper",r&&(r.style.display="none"),s&&(s.style.display="none");const f=m<=p||l.length<=1;if(n.classList.toggle("grid-active-section",!f),n.classList.toggle("slider-active-section",f),f){if(o.classList.add("slider-layout-active"),r&&l.length>1&&(r.style.display="flex"),s&&l.length>0&&(s.style.display="block"),S(!0),typeof Swiper<"u"&&l.length>0){if(a=new Swiper(o,{loop:l.length>1,slidesPerView:1,spaceBetween:10,pagination:{el:".swiper-pagination-slider",clickable:!0,dynamicBullets:l.length>5},navigation:{nextEl:".swiper-button-next-slider",prevEl:".swiper-button-prev-slider"},on:{init:_,slideChange:function(v){if(r){r.querySelectorAll(".thumbnail-v3").forEach(T=>T.classList.remove("active"));const x=r.querySelector(`.thumbnail-v3[data-index="${v.realIndex}"]`);x&&x.classList.add("active")}_(v)}}}),r&&l.length>1){const v=r.querySelector('.thumbnail-v3[data-index="0"]');v&&v.classList.add("active")}a&&_(a)}}else o.classList.add("grid-layout-active"),S(!1),o.classList.toggle("large-grid",m>I),o.classList.toggle("medium-grid",m>p&&m<=I),d.querySelectorAll(".swiper-slide:not(.has-more-photos-overlay) > a").forEach(v=>{v.addEventListener("mouseenter",()=>{o.classList.contains("grid-layout-active")&&o.classList.add("grid-hover-active")}),v.addEventListener("mouseleave",()=>{o.classList.contains("grid-layout-active")&&o.classList.remove("grid-hover-active")})});setTimeout(()=>n.classList.remove("layout-changing"),100)}const k=document.getElementById("floatingContactBtnV3"),W=document.querySelector(".agent-contact-card-v3");function U(m){if(!m)return!1;const f=m.getBoundingClientRect();return f.top<innerHeight&&f.bottom>=0&&f.left<innerWidth&&f.right>=0}function P(){if(!k)return;U(W)?k.classList.remove("visible"):k.classList.add("visible")}k&&(W&&(addEventListener("scroll",P,{passive:!0}),addEventListener("resize",P)),setTimeout(P,150),k.addEventListener("click",()=>{const m=document.querySelector(".agent-contact-card-v3");m?m.scrollIntoView({behavior:"smooth",block:"center"}):alert("Contact section not found.")})),B();let F;addEventListener("resize",()=>{clearTimeout(F),F=setTimeout(B,250)})}function be(){const n=document.getElementById("tabsWrapperV3"),o=document.getElementById("tabButtonsContainerV3"),d=document.getElementById("scrollTabsLeftBtn"),r=document.getElementById("scrollTabsRightBtn"),s=document.querySelectorAll(".tab-button-v3"),a=document.querySelectorAll(".tab-content-v3");if(!n||!o)return;s.length>0&&a.length>0&&s.forEach(y=>{y.addEventListener("click",()=>{const b=y.dataset.tab;s.forEach(l=>l.classList.remove("active")),y.classList.add("active"),a.forEach(l=>{l.classList.remove("active"),l.id===b+"ContentV3"&&l.classList.add("active")})})}),d&&r&&(d.addEventListener("click",()=>{const y=o.clientWidth*.75;o.scrollBy({left:-y,behavior:"smooth"})}),r.addEventListener("click",()=>{const y=o.clientWidth*.75;o.scrollBy({left:y,behavior:"smooth"})}));function p(){if(!n)return;const b=document.documentElement.getAttribute("dir")==="rtl"?-o.scrollLeft:o.scrollLeft,l=o.scrollWidth-o.clientWidth,h=10;b>h?n.classList.add("show-scroll-hint-start"):n.classList.remove("show-scroll-hint-start"),b<l-h?n.classList.add("show-scroll-hint-end"):n.classList.remove("show-scroll-hint-end")}function I(){requestAnimationFrame(()=>{o.scrollWidth>o.clientWidth+1?(n.classList.add("is-scrollable"),p()):n.classList.remove("is-scrollable","show-scroll-hint-start","show-scroll-hint-end")})}setTimeout(I,150),o.addEventListener("scroll",p,{passive:!0}),window.addEventListener("resize",I)}function Le(){const n=document.getElementById("videoPlaceholderV3");n&&window.AppConfig.pageData.video_url&&n.addEventListener("click",()=>{typeof Fancybox<"u"?Fancybox.show([{src:window.AppConfig.pageData.video_url+"?autoplay=1",type:"iframe",preload:!1,iframe:{attr:{allow:"autoplay; fullscreen",allowfullscreen:!0}}}]):(alert(__("video_not_available")),console.warn("Fancybox not loaded. Video cannot be opened in a modal."))})}function we(){const n='<span class="loading-spinner-container"><i class="fas fa-spinner loading-spinner-v3"></i></span>',o="initialCommentLoadingMessageV3";function d(t,c,i=null){t&&(c?(t.dataset.originalContent||(t.dataset.originalContent=t.innerHTML),t.innerHTML=n,t.classList.add("loading"),t.disabled=!0):(i!==null?t.innerHTML=i:t.dataset.originalContent&&(t.innerHTML=t.dataset.originalContent),(t.innerHTML===n||t.innerHTML==="")&&(t.classList.contains("load-more-comments-v3")||t.id==="loadMoreCommentsV3"?t.innerHTML='<span class="btn-text">'+e("load_more")+"</span>":t.type==="submit"&&(t.innerHTML='<span class="btn-text">'+e("send")+"</span>")),t.classList.remove("loading"),t.disabled=!1,delete t.dataset.originalContent))}const r=document.querySelectorAll(".community-tab-button-v3"),s=document.querySelectorAll(".community-tab-content-v3"),a=document.getElementById("addCommentFormV3");r.forEach(t=>{t.addEventListener("click",c=>{r.forEach(u=>u.classList.remove("active")),t.classList.add("active");const i=t.dataset.tab;s.forEach(u=>{u.classList.remove("active"),u.id===i&&u.classList.add("active")}),a&&!c.target.classList.contains("btn-add-review-v3")&&!a.contains(c.target)&&a.classList.contains("active")&&a.classList.remove("active")})});const p=document.querySelectorAll(".faq-item-v3");p.forEach(t=>{const c=t.querySelector(".faq-question-v3"),i=t.querySelector(".faq-answer-v3");c&&i&&c.addEventListener("click",()=>{const u=t.classList.contains("active");p.forEach(g=>{if(g!==t&&g.classList.contains("active")){g.classList.remove("active");const V=g.querySelector(".faq-answer-v3");V&&(V.style.maxHeight=null)}}),u?(t.classList.remove("active"),i.style.maxHeight=null):(t.classList.add("active"),i.style.maxHeight=i.scrollHeight+"px")})});function I(t,c){document.querySelectorAll(t).forEach(u=>{const g=u.id==="formStarRatingV3"?document.getElementById("userRatingInputV3"):u.nextElementSibling;if(!g){console.warn("Star rating hidden input not found for container:",u);return}const V=u.querySelectorAll("i");V.forEach(O=>{O.addEventListener("click",function(){const M=this.dataset.value;g.value=M,y(V,M)}),O.addEventListener("mouseover",function(){y(V,this.dataset.value,!0)}),O.addEventListener("mouseout",function(){y(V,g.value)})})})}function y(t,c,i=!1){t.forEach(u=>{const g=parseInt(u.dataset.value);u.classList.remove("fas","far","selected","hovered"),g<=parseInt(c)?(u.classList.add("fas"),i?u.classList.add("hovered"):u.classList.add("selected")):u.classList.add("far")})}function b(t){if(!t)return;t.querySelectorAll("i").forEach(i=>{i.classList.remove("fas","selected","hovered"),i.classList.add("far")})}document.getElementById("formStarRatingV3")&&document.getElementById("userRatingInputV3")&&I("#formStarRatingV3");const l=document.getElementById("averageRatingValueV3"),h=document.getElementById("averageStarsDisplayV3"),w=document.getElementById("averageRatingTotalReviewsV3"),A=document.getElementById("totalRatingCountV3"),q=document.getElementById("ratingBreakdownContainerV3");let C={average:0,totalReviews:0,breakdown:[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}]};function E(t){if(!t||t.length===0)return{average:0,totalReviews:0,breakdown:[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}]};let c=0,i=0;const u=[{stars:5,count:0},{stars:4,count:0},{stars:3,count:0},{stars:2,count:0},{stars:1,count:0}];function g(O){O.forEach(M=>{M.rating&&M.rating>0&&M.parentId===null&&(c+=M.rating,i++,M.rating>=1&&M.rating<=5&&u[5-M.rating].count++)})}return g(t),{average:i>0?c/i:0,totalReviews:i,breakdown:u}}function S(){if(C=E(P),l&&(l.textContent=C.average.toFixed(1)),w&&(w.textContent=C.totalReviews),A&&(A.textContent=C.totalReviews),h){h.innerHTML="";let t=C.average;for(let c=1;c<=5;c++){const i=document.createElement("i");t>=.75?(i.className="fas fa-star",t--):t>=.25?(i.className="fas fa-star-half-alt",t=0):i.className="far fa-star",h.appendChild(i)}}q&&(q.innerHTML="",C.breakdown.forEach(t=>{const c=C.totalReviews>0?t.count/C.totalReviews*100:0,i=document.createElement("div");i.className="rating-bar-row-v3",i.innerHTML=`<span>${t.stars} ${t.stars===1?e("star_1"):t.stars===2?e("star_2"):e("stars")}</span><div class="rating-bar-v3"><div class="rating-bar-filled-v3" style="width: ${c.toFixed(1)}%;"></div></div><span>(${t.count})</span>`,q.appendChild(i)}))}const _=document.getElementById("commentListV3"),B=document.getElementById("loadMoreCommentsV3"),k=document.getElementById("noMoreCommentsMessageV3"),W=document.getElementById("totalCommentCountV3");let U=null,P=[{id:1,author:"أحمد محمد",avatar:"https://placehold.co/36x36/778899/FFFFFF?text=A",rating:5,text:`فيلا رائعة جداً!
الموقع ممتاز والتشطيبات فاخرة.
أنصح بها بشدة للعائلات الكبيرة.`,date:"منذ يومين",parentId:null,replies:[{id:101,author:"مجموعة الثقة (الوكيل)",avatar:"https://placehold.co/32x32/0062cc/FFFFFF?text=و",rating:0,text:"شكراً جزيلاً لتقييمك الرائع أستاذ أحمد! نسعد بخدمتك.",date:"منذ يوم",parentId:1,replies:[]}]},{id:2,author:"سارة علي",avatar:"https://placehold.co/36x36/AACCFF/000000?text=S",rating:4,text:"تجربة جيدة بشكل عام، بعض الملاحظات البسيطة على الصيانة ولكن السعر مناسب.",date:"منذ أسبوع",parentId:null,replies:[{id:201,author:"مجموعة الثقة (الوكيل)",avatar:"https://placehold.co/32x32/0062cc/FFFFFF?text=و",rating:0,text:"شكراً لملاحظاتك سارة، نعمل على تحسين خدمات الصيانة باستمرار.",date:"منذ 6 أيام",parentId:2,replies:[]}]},{id:3,author:"خالد عبدالله",avatar:"https://placehold.co/36x36/FFD700/000000?text=K",rating:5,text:"كل شيء كان مثالياً، من الحجز إلى المغادرة. خدمة العملاء ممتازة.",date:"منذ 3 أسابيع",parentId:null,replies:[]},{id:4,author:"نورة إبراهيم",avatar:"https://placehold.co/36x36/E6E6FA/000000?text=N",rating:3,text:"الموقع جيد ولكن الأثاث يحتاج إلى تحديث بسيط. السعر معقول.",date:"منذ شهر",parentId:null,replies:[{id:102,author:"أحمد محمد",avatar:"https://placehold.co/32x32/778899/FFFFFF?text=A",rating:0,text:"أتفق معكِ بشأن الأثاث، لكن الموقع يعوض ذلك.",date:"منذ 3 أسابيع",parentId:4,replies:[{id:103,author:"نورة إبراهيم",avatar:"https://placehold.co/30x30/E6E6FA/000000?text=N",rating:0,text:"صحيح، سأفكر في الأمر مرة أخرى.",date:"منذ أسبوعين",parentId:102,replies:[]}]}]},{id:5,author:"عمر ياسين",avatar:"https://placehold.co/36x36/228B22/FFFFFF?text=O",rating:4,text:"المكان نظيف وهادئ جداً، مثالي للاسترخاء. الواي فاي كان ضعيفاً بعض الشيء.",date:"منذ شهرين",parentId:null,replies:[]},{id:6,author:"فاطمة حسن",avatar:"https://placehold.co/36x36/FFC0CB/000000?text=F",rating:5,text:"أفضل إقامة قضيتها على الإطلاق! الموظفون ودودون والمرافق ممتازة.",date:"منذ 3 شهور",parentId:null,replies:[]}],F=0;const m=2;function f(t,c=0){const i=document.createElement("div");i.className="comment-item-v3",i.dataset.commentId=t.id;const u=c*25,g=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft";c>0&&(i.style[g]=`${u}px`);let V="";if(t.rating&&t.rating>0)for(let X=1;X<=5;X++)V+=`<i class="${X<=t.rating?"fas":"far"} fa-star"></i>`;const O=Math.max(24,36-c*4);let M="";if(t.replies&&t.replies.length>0&&c<2){const X=t.replies.length===1?e("replay_1"):t.replies.length===2?e("replay_2"):`${t.replies.length} `+e("replaies");M=`<button class="comment-action-btn-v3 btn-view-replies" data-comment-id="${t.id}"><i class="fas fa-comments"></i> ${X}</button>`}i.innerHTML=`
            <div class="comment-author-v3">
                <img src="${t.avatar}" alt="${t.author}" class="comment-avatar-v3" style="width:${O}px; height:${O}px;">
                <div>
                    <span class="comment-author-name-v3">${t.author}</span>
                    ${t.rating>0?`<div class="comment-author-rating-v3 stars-display-v3">${V}</div>`:""}
                </div>
            </div>
            <p class="comment-text-v3">${t.text.replace(/\n/g,"<br>")}</p>
            <div class="comment-meta-v3">
                <span class="comment-date-v3">${t.date}</span>
                <div class="comment-actions-group">
                    ${M}
                    ${c<2?`<button class="comment-action-btn-v3 btn-show-reply-form reply-btn-v3" data-parent-id="${t.id}"><i class="fas fa-reply"></i> <span>رد</span></button>`:""}
                </div>
            </div>
            <div class="comment-replies-container-v3" style="display: none;"></div>
            <div class="reply-form-container-v3" style="display:none;"></div>`;const $=i.querySelector(".btn-view-replies");$&&$.addEventListener("click",function(){const X=parseInt(this.dataset.commentId),Q=i.querySelector(".comment-replies-container-v3");x(Q,X,this)});const j=i.querySelector(".btn-show-reply-form");return j&&j.addEventListener("click",function(){const X=this.dataset.parentId,Q=i.querySelector(".reply-form-container-v3");T(Q,X)}),i}function v(t,c){for(let i of t){if(i.id===c)return i;if(i.replies&&i.replies.length>0){const u=v(i.replies,c);if(u)return u}}return null}async function x(t,c,i){if(!t||!i)return;const u=v(P,c);if(!u||!u.replies||u.replies.length===0)return;const g=t.style.display==="block",V=comment.replies.length===1?e("replay_1"):comment.replies.length===2?e("replay_2"):`${comment.replies.length} `+e("replaies");if(g)t.style.display="none",t.innerHTML="",d(i,!1,`<i class="fas fa-comments"></i> ${V}`),i.classList.remove("replies-shown");else{d(i,!0),await new Promise(j=>setTimeout(j,500)),t.innerHTML="";let O=0;const M=i.closest(".comment-item-v3"),$=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft";M&&M.style[$]&&(O=parseInt(M.style[$])/25||0),u.replies.forEach(j=>{t.appendChild(f(j,O+1))}),t.style.display="block",d(i,!1,'<i class="fas fa-comment-slash"></i> '+e("hide_replies")),i.classList.add("replies-shown")}}function T(t,c){if(U&&U!==t&&(U.style.display="none",U.innerHTML=""),t.style.display==="none"||U!==t){t.innerHTML=`
                <form class="add-reply-form-v3" data-parent-id="${c}">
                    <textarea name="replyText" rows="2" placeholder="${e("please_write_commit")}" required class="input-v3"></textarea>
                    <div class="reply-form-actions">
                        <button type="submit" class="btn-v3 btn-v3-primary btn-sm-v3">
                            <span class="btn-text">`+e("submit_reply")+`</span>
                        </button>
                        <button type="button" class="btn-v3 btn-v3-link btn-sm-v3 btn-cancel-reply">`+e("cancel")+`</button>
                    </div>
                </form>`,t.style.display="block",t.querySelector("textarea").focus(),U=t;const i=t.querySelector(".add-reply-form-v3");i.addEventListener("submit",H),i.querySelector(".btn-cancel-reply").addEventListener("click",()=>{t.style.display="none",t.innerHTML="",U=null})}else t.style.display="none",t.innerHTML="",U=null}async function H(t){t.preventDefault();const c=t.target,i=c.querySelector('button[type="submit"]'),u=parseInt(c.dataset.parentId),g=c.querySelector('textarea[name="replyText"]').value;if(g.trim()===""){alert(e("please_write_reply"));return}d(i,!0),await new Promise(O=>setTimeout(O,700));const V={id:Date.now(),author:e("you_visitor"),avatar:"https://placehold.co/32x32/999999/FFFFFF?text=U",rating:0,text:g,date:"الآن",parentId:u,replies:[]};D(V,u),z(V,u),W&&(W.textContent=G(P)),d(i,!1),c.parentElement&&(c.parentElement.style.display="none",c.parentElement.innerHTML=""),U=null}function D(t,c){function i(u){for(let g of u){if(g.id===c)return g.replies||(g.replies=[]),g.replies.unshift(t),!0;if(g.replies&&g.replies.length>0&&i(g.replies))return!0}return!1}i(P)}function z(t,c){const i=_.querySelector(`.comment-item-v3[data-comment-id="${c}"]`);if(i){const u=i.querySelector(".comment-replies-container-v3");let g=0;const V=document.documentElement.getAttribute("dir")==="rtl"?"marginRight":"marginLeft",O=i.style[V]||"0px";if(g=parseInt(O)/25||0,u.prepend(f(t,g+1)),u.style.display==="none"){u.style.display="block";const M=i.querySelector(".btn-view-replies");if(M){const $=v(P,c);M.innerHTML='<i class="fas fa-comment-slash"></i> '+e("hide_replies"),M.classList.add("replies-shown"),$&&$.replies&&$.replies.length>0&&($.replies.length===1?e("replay_1"):$.replies.length===2?e("replay_2"):`${$.replies.length} `+e("replaies"))}}else{const M=i.querySelector(".btn-view-replies");if(M){const $=v(P,c);if($&&$.replies&&$.replies.length>0){const j=$.replies.length===1?e("replay_1"):$.replies.length===2?e("replay_2"):`${$.replies.length} `+e("replaies");M.classList.contains("replies-shown")?M.innerHTML='<i class="fas fa-comment-slash"></i> '+e("hide_replies"):M.innerHTML=`<i class="fas fa-comments"></i> ${j}`}}}}}function G(t){let c=0;function i(u){u.forEach(g=>{c++,g.replies&&g.replies.length>0&&i(g.replies)})}return i(t),c}async function N(){if(!_)return;const t=F===0&&(_.children.length===0||_.children.length===1&&_.children[0].id===o);t?document.getElementById(o)||(_.innerHTML=`<p style="text-align:center; padding:10px;" id="${o}"> ${e("loading_more_comments")} ${n}</p>`):B&&d(B,!0),await new Promise(V=>setTimeout(V,800));const c=document.getElementById(o);c&&c.remove(),B&&!t&&d(B,!1,'<span class="btn-text">'+e("load_more")+"</span>");const i=document.createDocumentFragment(),u=P.filter(V=>V.parentId===null),g=u.slice(F,F+m);g.length===0&&F===0?(_.innerHTML.trim()===""&&(_.innerHTML='<p class="no-more-comments-v3" style="display:block; text-align:center;">'+e("no_comments_yet")+"</p>"),B&&(B.style.display="none"),k&&(k.style.display="none")):(g.forEach(V=>i.appendChild(f(V,0))),_.appendChild(i)),F+=g.length,F>=u.length?(B&&(B.style.display="none"),k&&u.length>0?k.style.display="block":k&&(k.style.display="none")):(B&&u.length>0&&(B.style.display="block"),k&&(k.style.display="none")),W&&(W.textContent=G(P))}B&&B.addEventListener("click",N);const K=document.querySelectorAll(".btn-add-review-v3"),Z=a?a.querySelector(".btn-cancel-comment-review-v3"):null;K.forEach(t=>{t.addEventListener("click",()=>{if(a){a.classList.add("active"),a.scrollIntoView({behavior:"smooth",block:"center"});const c=a.querySelector('textarea[name="commentText"]');c&&c.focus()}})}),Z&&a&&Z.addEventListener("click",()=>{a.classList.remove("active"),a.reset();const t=document.getElementById("formStarRatingV3");t&&b(t);const c=document.getElementById("userRatingInputV3");c&&(c.value="0")}),a&&a.addEventListener("submit",async function(t){t.preventDefault();const c=this.querySelector('button[type="submit"]'),i=document.getElementById("userRatingInputV3"),u=document.getElementById("commentTextV3"),g=document.getElementById("commenterNameV3"),V=i?i.value:"0",O=u?u.value:"",M=g&&g.value?g.value:e("visitor");if(O.trim()===""){alert(e("please_write_commit"));return}d(c,!0),await new Promise(X=>setTimeout(X,900));const $={id:Date.now(),author:M,avatar:`https://placehold.co/36x36/ccc/000?text=${M.substring(0,1).toUpperCase()||"Z"}`,rating:parseInt(V)||0,text:O,date:"الآن",parentId:null,replies:[]};if(P.unshift($),_.querySelector('p.no-more-comments-v3[style*="display:block"]')||document.getElementById(o))_.innerHTML="",F=0,N();else{_.prepend(f($,0)),F++;const X=P.filter(Q=>Q.parentId===null);F<X.length&&B&&(B.style.display="block"),k&&(k.style.display="none")}W&&(W.textContent=G(P)),S(),d(c,!1),alert(e("thank_you_for_your_submission")),this.reset();const j=document.getElementById("formStarRatingV3");j&&b(j),i&&(i.value="0"),this.classList.remove("active")}),S(),N()}const Ce=function(){let n;function o(){if(!document.getElementById("leafletMapContainerV3"))return;const r=window.AppConfig.pageData.latitude,s=window.AppConfig.pageData.longitude;if(r===null||s===null){console.warn("Property latitude or longitude is not set.");return}n=L.map("leafletMapContainerV3").setView([r,s],17),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}).addTo(n),L.marker([r,s]).addTo(n)}return{init:o}}();function _e(){const n=document.querySelector(".mobile-menu-toggle-v3"),o=document.querySelector(".site-header-v3");n&&o&&n.addEventListener("click",()=>{o.classList.toggle("mobile-menu-open-v3")})}ce();re();de();ue();pe();me();fe();ge();ye();he();ve();be();Le();we();Ce.init();_e();
